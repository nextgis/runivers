"use strict";(globalThis.webpackChunkrussia_history=globalThis.webpackChunkrussia_history||[]).push([[659],{14646:(e,t,i)=>{i.d(t,{g:()=>w});var n=i(17187),a=i(25707),s=i(13862),r=i(9578),o=i(7450),h=i(58497),d=i(76005),l=i(28691),c=i(32175),p=i(95060),m=(i(26699),i(24613));function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class y{constructor(e,t){var i,n;this.webMap=e,this.options=t,u(this,"name",void 0),u(this,"currentLayerId",void 0),u(this,"beforeLayerId",void 0),u(this,"opacity",.8),u(this,"order",void 0),u(this,"pointFitMaxZoom",7),u(this,"polygonFitMaxZoom",12),u(this,"_filter",void 0),u(this,"_visible",!0),u(this,"_popup",void 0),u(this,"_timeLayers",{}),u(this,"_layersLoaded",{}),u(this,"_onDataLoadEvents",[]),u(this,"_onLayerClickMem",{}),this.name=this.options.name,this._visible=null===(i=this.options.visible)||void 0===i||i,t.order=null!==(n=t.order)&&void 0!==n?n:this.webMap.reserveOrder(),this.order=t.order,void 0!==t.opacity&&(this.opacity=t.opacity),this._isWaitDataLoadedGroup()&&(e.mapAdapter.emitter.on("data-loaded",(e=>this._onData(e))),e.mapAdapter.emitter.on("data-error",(e=>this._onData(e))))}hide(){if(this._visible){const e=Object.keys(this._timeLayers);for(const t of e)this._hideLayer(t);this._visible=!1}}show(){!this._visible&&this.currentLayerId&&(this._visible=!0,this._showLayer(this.currentLayerId))}updateLayer(e){return this.beforeLayerId=this.currentLayerId,this.currentLayerId=e,this.switchLayer(this.beforeLayerId||"",e)}updateLayersColor(){const e=this.webMap.mapAdapter.map;if(e&&this.options.getFillColor){const t=this.options.getFillColor({darken:.5}),i=this.options.getFillColor();for(const n in this._layersLoaded)-1!==n.indexOf("-bound")?e.setPaintProperty(n,"line-color",t):e.setPaintProperty(n,"fill-color",i)}}pushDataLoadEvent(e){this._onDataLoadEvents.push(e)}fitToFilter(e,t){const i=this.webMap.mapAdapter.map;if(i&&"string"==typeof t.source){let n=[];if(t.source.startsWith("ngw:")){const a=i.getSource(t.source)._data,s=this.options.filterIdField||"id";n=a.features.filter((t=>{const i=[].concat(e[2]);return t.properties&&-1!==i.indexOf(t.properties[s])}))}else{const a="ngw:"+(t.options.name||t.id),s=t.source;n=i.querySourceFeatures(s,{filter:e,sourceLayer:a})}if(n&&n.length)return this._fitToFeatures(n),n}}showOnlyCurrentLayer(){this.hideNotCurrentLayers(),this.makeOpacity()}clean(){this._removePopup(),this._cleanDataLoadEvents(),this.currentLayerId&&(this._removeLayerListeners(this.currentLayerId),this._hideLayer(this.currentLayerId)),this.currentLayerId=void 0}switchLayer(e,t){return new Promise(((i,n)=>{this._removePopup(),this._cleanDataLoadEvents(),t&&e!==t?(this.pushDataLoadEvent(i),this._showLayer(t).then((t=>{t===this.currentLayerId?(this._addLayerListeners(t),e&&(this._removeLayerListeners(e),this._setLayerOpacity(t,0)),this._isWaitDataLoadedGroup()||this._onSourceIsLoaded()):n("Not current id")})).catch((e=>{n(e)}))):i("")})).then((()=>t))}hideLayer(e){this._hideLayer(e)}getTimeLayer(e){if(e=void 0!==e?e:this.currentLayerId)return this._timeLayers[e]}forEachTimeLayer(e,t){const i=this._timeLayers[e];if(i)for(const e of i)t(e)}selectLayerFeature(e,t){const i=e.properties;if(i&&this.options.filterIdField){const e=this.options.filterIdField,n=i[e],a=this._getWebMapLayer(t);a&&a.select&&a.select([[e,"eq",Number(n)]])}}select(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t=null!==(i=t)&&void 0!==i?i:this.currentLayerId){const i=e.split(",").map((e=>Number(e))),a=this._timeLayers[t],s=this.options.filterIdField,r=[];for(const e of a){const t=e&&e.layer&&e.layer[0];i&&t&&s&&e&&e.select&&(e.select([[s,"in",i]]),r.push(e))}if(n)for(const e of r){const t=this.fitToFilter(["in",s,...i],e);if(t&&t.length)return t}}}setFilter(e){e&&e.length?this._filter=e:this._filter=void 0,this.options.setFilter?this.options.setFilter(this._filter||[],this.currentLayerId):this._updateFilter()}hideNotCurrentLayers(){const e=Object.keys(this._timeLayers);for(const t of e)t!==this.currentLayerId&&this._hideLayer(t)}_cleanDataLoadEvents(){this._onDataLoadEvents=[]}makeOpacity(){this.currentLayerId&&this._setLayerOpacity(this.currentLayerId,this.opacity)}_getWebMapLayerId(e){return String(e)}_getWebMapLayer(e){return this.webMap.getLayer(this._getWebMapLayerId(e))}_isWaitDataLoadedGroup(){return void 0===this.options.dataLoaded||this.options.dataLoaded}_setLayerOpacity(e,t){const i=this._isWaitDataLoadedGroup();this.forEachTimeLayer(e,(e=>i?this.webMap.setLayerOpacity(e,t):0===t?this.webMap.hideLayer(e):this.webMap.showLayer(e)))}_removePopup(){this._popup&&(this._popup.remove(),this._popup=void 0)}_isCurrentDataLayer(e){const t=void 0!==this.currentLayerId&&this._timeLayers[this.currentLayerId];return!!t&&t.some((t=>t.id===e||t.options.name===e||t.layer&&t.layer.some((t=>t===e))))}_getLayerIdFromSource(e){if(this._timeLayers[e])return e;for(const t in this._timeLayers){const i=this._timeLayers[t].find((t=>t.source&&t.source===e||t.options&&t.options.url&&t.options.url===e));if(i)return i.id}}_onData(e){const t=this._getLayerIdFromSource(e.target);if(t){const e=this._layersLoaded[t],i=this._isCurrentDataLayer(t),n=this._isHistoryLayer(t);!e&&n&&i&&(this._layersLoaded[t]=!0,this._onSourceIsLoaded())}}_onLayerClick(e,t,i){const n=this.webMap.mapAdapter.map,a=e.point;if(n){var s;const r=n.queryRenderedFeatures([[a.x-2.5,a.y-2.5],[a.x+2.5,a.y+2.5]],{layers:[t]})[0],o=r.properties;if(this.options.createPopupContent){const t=this.options.createPopupContent(o);t&&(this._removePopup(),this._popup=(new m.Popup).setLngLat(e.lngLat).setDOMContent(t).addTo(n))}(null===(s=this.options.selectOnLayerClick)||void 0===s||s)&&this.selectLayerFeature(r,i)}}_removeLayerListeners(e){const t=this.webMap.mapAdapter.map,i=this._onLayerClickMem[e];if(i&&t)for(const e in i){const n=i[e];n&&t.off(e,n)}this._removePopup()}_addLayerListeners(e){const t=this.webMap.mapAdapter.map;t&&this._forEachDataLayer(e,(i=>{const n=t=>this._onLayerClick(t,i,e);t.on("click",i,n),t.on("mouseenter",i,(()=>t.getCanvas().style.cursor="pointer")),t.on("mouseleave",i,(()=>t.getCanvas().style.cursor="")),this._onLayerClickMem[i]=this._onLayerClickMem[i]||{},this._onLayerClickMem[i].click=n,this._onLayerClickMem[i].mouseenter=n,this._onLayerClickMem[i].mouseleave=n}))}_isHistoryLayer(e){return!this.webMap.isBaseLayer(e)}_isAllDataLayerLoaded(e){if(!this._isWaitDataLoadedGroup())return!0;{const t=this._timeLayers[e];if(t)return t.every((t=>t.id===e||t.options.name===e||t.layer&&t.layer.some((e=>this._layersLoaded[e]))))}}_forEachDataLayer(e,t){this.forEachTimeLayer(e,(e=>e.layer&&e.layer.forEach((e=>{t(e)}))))}_onSourceIsLoaded(){this.currentLayerId&&this._isAllDataLayerLoaded(this.currentLayerId)&&(this.options.manualOpacity||this.showOnlyCurrentLayer(),this._executeDataLoadEvents())}_executeDataLoadEvents(){for(let e=0;e<this._onDataLoadEvents.length;e++)(0,this._onDataLoadEvents[e])();this._onDataLoadEvents=[]}async _addLayer(e,t){const i=await this.options.addLayers(e,t);if(i){this._timeLayers[t]=[];for(const e of i){const i=await e;this._timeLayers[t].push(i)}return this._timeLayers[t]}}_toggleLayer(e,t){this._forEachDataLayer(e,(e=>{this._layersLoaded[e]=!1})),this._layersLoaded[e]=!1,t?this._showLayer(e):(this.forEachTimeLayer(e,(e=>{this.webMap.removeLayer(e)})),this._timeLayers[e]=[])}_hideLayer(e){this._toggleLayer(e,!1)}_showLayer(e){if(this._visible){const t=()=>(this.forEachTimeLayer(e,(e=>this.webMap.toggleLayer(e,!0))),e);if(this._getWebMapLayer(e))return Promise.resolve(t());{const i=this.options.setUrl?this.options.setUrl({baseUrl:this.options.baseUrl,resourceId:e}):this.options.oldNgwMvtApi?this.options.baseUrl+"/api/resource/"+e+"/{z}/{x}/{y}.mvt":this.newNgwMvtUrl({baseUrl:this.options.baseUrl,resourceId:e});return this._addLayer(i,e).then((()=>t()))}}return new Promise(((t,i)=>{setTimeout((()=>{this._executeDataLoadEvents(),t(e)}),0)}))}newNgwMvtUrl(e){return e.baseUrl+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+e.resourceId}_fitToFeatures(e){const t=new m.LngLatBounds,i=[],n=e=>{if(2===e.length)try{t.extend(e)}catch(e){}else e.forEach((e=>{n(e)}))};for(const t of e){const e=t.geometry;n(e.coordinates),i.push(t.geometry.type)}if(this.webMap.mapAdapter.map){const e=i.every((e=>"Point"===e));this.webMap.mapAdapter.map.fitBounds(t,{padding:20,maxZoom:e?this.pointFitMaxZoom:this.polygonFitMaxZoom})}}_updateFilter(){if(this.currentLayerId){const e=this._timeLayers[this.currentLayerId],t=this.options.filterIdField;for(const i of e)t&&i&&i.propertiesFilter&&i.propertiesFilter(this._filter||[])}}}function _(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let g=0;class L{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.webMap=e,this.options=t,_(this,"emitter",new n.EventEmitter),_(this,"currentYear",void 0),_(this,"nextYear",void 0),_(this,"_minYear",0),_(this,"_maxYear",0),_(this,"_timeLayersGroups",[]),_(this,"_onGroupsLoadEvents",[]),_(this,"_groupsConfig",{}),_(this,"_loadLayerPromises",{})}getTimeGroup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._timeLayersGroups.find((t=>t.name===e))}getTimeGroupByAdapterId(e){return this._getTimeGroupBy((t=>t.id===e))}getTimeGroupByLayerId(e){return this._getTimeGroupBy((t=>{var i;return!(null===(i=t.layer)||void 0===i||!i.includes(e))}))}getTimeGroups(){return this._timeLayersGroups}addTimeGroup(e){const t=new y(this.webMap,e);this._timeLayersGroups.push(t)}updateByYear(e,t){const i=this._getLayerIdsByYear(e,t);i&&this.updateLayers(i),this.options.onLayerUpdate&&this.options.onLayerUpdate(e)}updateLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const i=this.getTimeGroup(t);return i?e?i.updateLayer(e).then((()=>i)):(i.clean(),Promise.resolve(void 0)):Promise.resolve(void 0)}async updateLayers(e){const t=await this.getUpdateLayersPromise(e);return this.finishLoading(t,e)}resetLoading(){this._timeLayersGroups.forEach((e=>{e.beforeLayerId&&(e.currentLayerId=e.beforeLayerId,e.hideNotCurrentLayers(),e.beforeLayerId=void 0)})),this.options.onReset&&this.options.onReset(),this._loadLayerPromises={},this.emitter.emit("loading:finish",!1)}finishLoading(e,t){const i=Object.keys(t);this._timeLayersGroups.forEach((e=>{e.beforeLayerId=void 0,i.includes(e.name)||e.currentLayerId&&e.hideLayer(e.currentLayerId)})),e.forEach((e=>e())),this._loadLayerPromises={},this.emitter.emit("loading:finish",t)}getUpdateLayersPromise(e){const t=[];return this.emitter.emit("loading:start",e),Object.keys(e).forEach((i=>{const n=e[i],a=this._loadLayerPromises[i];if(a&&a.promise)t.push(a.promise);else{const e=this.updateLayer(n,i).then((e=>(delete this._loadLayerPromises[i],()=>{e&&(e.showOnlyCurrentLayer(),this.emitter.emit("loading-layer:finish",{layerId:n,layer:e}))})));t.push(e)}})),Promise.all(t)}pushDataLoadEvent(e){const t=g++,i=this._timeLayersGroups.map((e=>new Promise(((t,i)=>{e.pushDataLoadEvent(t)}))));return this._onGroupsLoadEvents[t]=e,Promise.all(i).then((()=>{const e=this._onGroupsLoadEvents[t];e&&e()})),t}unselect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._timeLayersGroups.forEach((t=>{(!e.exclude||-1===e.exclude.indexOf(t.name))&&t.currentLayerId&&t.forEachTimeLayer(t.currentLayerId,(e=>{e.unselect&&e.selected&&e.unselect()}))}))}buildTimeMap(e){this._groupsConfig=this._processGroupsMeta(e),this._addTimeLayersGroups(e),!this.currentYear&&this._minYear&&(this.currentYear=this._minYear),Object.values(this._groupsConfig).forEach((e=>{e.layersMeta.sort(((e,t)=>e.from<t.from?-1:1))}))}_addTimeLayersGroups(e){e.forEach((e=>{const t=this.options.getStatusLayer(e);t&&this.addTimeGroup(t)}))}async _stepReady(e,t,i){let n=this._getLayersByYear(e,i);if(n||(n=this._getNextLayers(e,i)),n){let i,a;const s=e;this.nextYear=s;const r=()=>{const e=()=>{this.nextYear=void 0,this.currentYear=s,i&&a&&this.finishLoading(i,a),this.options.onStepReady&&this.options.onStepReady(s)},n=()=>{this.nextYear=void 0,this.resetLoading()};t(s,(()=>e()),(()=>n()))};Object.entries(n).every((e=>{let[t,i]=e;const n=this.getTimeGroup(t);if(n){const e=i&&i.id;return n.currentLayerId===String(e)}return!0}))||(a=this._layerMetaToIdRecord(n),i=await this.getUpdateLayersPromise(a)),r()}else this._minYear&&this._maxYear&&t(i?this._minYear:this._maxYear)}_getTimeGroupBy(e){for(let t=0;t<this._timeLayersGroups.length;t++){const i=this._timeLayersGroups[t],n=i.getTimeLayer();if(n)for(let t=0;t<n.length;t++){const a=n[t];if(a&&e(a))return{timeGroup:i,timeLayer:a}}}}_getLayersByYear(e,t){const i={};return this.getTimeGroups().forEach((n=>{const a=this._groupsConfig[n.name].layersMeta.filter((t=>e>=t.from&&e<=t.to));i[n.name]=!!a.length&&(t?a[0]:a[a.length-1])})),i}_getLayerIdsByYear(e,t){const i=this._getLayersByYear(e,t);return this._layerMetaToIdRecord(i)}_layerMetaToIdRecord(e){const t={};return Object.entries(e).forEach((e=>{let[i,n]=e;t[i]=!!n&&String(n.id)})),t}_getNextLayers(e,t){const i=this._getLayersByYear(e),n={};for(const a in i){const s=i[a];let r;const o=this._groupsConfig[a];if(s){const e=this.getTimeGroup(o.name).currentLayerId;if(String(s.id)===e){const e=o.layersMeta.indexOf(s);-1!==e&&(r=o.layersMeta[t?e-1:e+1])}}else r=t?o.layersMeta.slice().reverse().find((t=>t.to<=e)):o.layersMeta.find((t=>t.from>=e));r&&(n[a]=r)}return n}_processGroupsMeta(e){const t={};return e.forEach((e=>{const i=[];e.items.forEach((e=>{let{resource:t}=e;const n=t.display_name,a=n.match("(\\d{3,4})_(to_)?(\\d{3,4}).*$");if(a){const[e,s]=[a[1],a[3]].map((e=>Number(e)));!(this.options.fromYear&&e<this.options.fromYear||this.options.toYear&&s>this.options.toYear)&&(this._minYear=(this._minYear>e?e:this._minYear)||e,this._maxYear=(this._maxYear<s?s:this._maxYear)||s,i.push({name:n,from:e,to:s,id:t.id}))}})),t[e.name]={layersMeta:i,name:e.name}})),t}}var f=i(1319),b=i(41171),v=i(78879);function S(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class w{constructor(e){S(this,"options",{target:"#app",style:{transition:{duration:0,delay:0},glyphs:location.origin+location.pathname+"font/{fontstack}/{range}.pbf"}}),S(this,"controls",void 0),S(this,"slider",void 0),S(this,"webMap",void 0),S(this,"urlParams",f.B),S(this,"emitter",new n.EventEmitter),S(this,"timeMap",void 0),S(this,"updateDataByYear",void 0),S(this,"statusLayers",{cities:v.e}),S(this,"_markers",void 0),this.options={...this.options,...e},this._markers=new b.u(this);const t=this.urlParams.get("year");t&&(this.options.currentYear=parseInt(t,10));const{fromYear:i,currentYear:a}=this.options;i&&a&&a<i&&(this.options.currentYear=i),this.updateDataByYear=(0,o.D)((e=>this._updateDataByYear(e)),300),this.createWebMap().then((()=>{this._buildApp()}))}async createWebMap(){const e={...this.options},{bounds:t,target:i}=e,n=new s.y9({mapAdapter:new a.Z,starterKits:[new r.WL],bounds:t,target:i});return await n.onLoad(),this.timeMap=new L(n,{fromYear:this.options.fromYear,getStatusLayer:e=>this._getStatusLayer(e),onStepReady:e=>this.updateDataByYear(e),onLayerUpdate:e=>this.updateDataByYear(e),onReset:()=>this.onReset()}),this.timeMap.emitter.once("loading:finish",(()=>{this._setSelectedLayerFromUrl()})),this.options.currentYear&&(this.timeMap.currentYear=this.options.currentYear),n.addBaseLayer("OSM",{id:"baselayer"}),this.webMap=n,n}onReset(){this._markers&&this.updateDataByYear(this.timeMap.currentYear)}getTimeStop(e){const t=this.options.timeStops.find((t=>e<t.toYear));return t?t.name:""}updateLayersColor(){}_updateDataByYear(e){const t=this._markers._getPointIdByYear(e);this._markers.updatePoint(t);const i=this._findAreaStatByYear(e);this._updatePeriodBlockByYear(e,i),this._updateYearStatBlockByYear(e,i),this.urlParams.set("year",String(e))}_setSelectedLayerFromUrl(){const e=f.B.get("id");if(e){const t=this.timeMap.getTimeGroup("base");t&&t.select(e)}}_buildApp(){(0,d.x)((e=>{this.timeMap.buildTimeMap(e),this.slider=this._createSlider(),this._createHeader(),this._createAffiliatedLogos(),this.controls=new p.Z(this),this.controls.updateControls(),this.webMap.onMapLoad((()=>{this.timeMap.updateByYear(this.timeMap.currentYear)})),this.emitter.emit("build"),this._addEventsListeners()})),(0,l.E)().then((e=>{this._markers.setPoints(e)}))}_getStatusLayer(e){const t={name:e.name,baseUrl:this.options.baseUrl,opacity:e.opacity,manualOpacity:!0,filterIdField:"fid"},i=this.statusLayers[e.name];if(i)return new i(this,t)}_createSlider(){const e=new h.z({type:"range",min:this.timeMap._minYear,max:this.timeMap._maxYear,step:1,animationStep:this.options.animationStep||1,value:this.timeMap.currentYear,animationDelay:this.options.animationDelay||200,stepReady:(e,t,i)=>{this.timeMap._stepReady(e,t)}});e.emitter.on("change",(e=>{e!==this.timeMap.currentYear&&e!==this.timeMap.nextYear&&(this.timeMap.currentYear=e,this.timeMap.updateByYear(e))}));const t=this.webMap.mapAdapter.getContainer();return t&&t.appendChild(e.onAdd(this.webMap)),e}_createHeader(){const e=document.createElement("div");e.className="font-effect-shadow-multiple app-header";const t=document.createElement("span");t.innerHTML=`\n      Границы России ${this.timeMap._minYear}-${this.timeMap._maxYear} гг.`,e.appendChild(t),e.appendChild((0,c.$m)(this));const i=this.webMap.mapAdapter.getContainer();return i&&i.appendChild(e),e}_createAffiliatedLogos(){const e=document.createElement("div");e.className="app-affiliated-logos",e.appendChild((0,c.vq)(this));const t=this.webMap.mapAdapter.getContainer();return t&&t.appendChild(e),e}_updatePeriodBlockByYear(e,t){const i=this._findPeriodByYear(e);i&&this.controls.periodsPanelControl&&this.controls.periodsPanelControl.updatePeriod(i,t)}_findPeriodByYear(e){return(this.options.periods||[]).find((t=>{let i=e>=t.years_from;return i&&t.years_to&&(i=e<=t.years_to),i}))}_updateYearStatBlockByYear(e,t){if(this.controls.yearsStatPanelControl){const i=this._findYearStatsByYear(e);this.controls.yearsStatPanelControl.updateYearStats(i,t)}}_findAreaStatByYear(e){if(this.options.areaStat)return this.options.areaStat.find((t=>t.year===e))}_findYearStatsByYear(e){return e=Number(e),(this.options.yearsStat||[]).filter((t=>e===t.year))}_addEventsListeners(){this.controls.yearsStatPanelControl&&this.controls.yearsStatPanelControl.emitter.on("update",(e=>{let{yearStat:t}=e;this._markers.updateActiveMarker(t)})),this.webMap.emitter.on("preclick",(()=>{this.timeMap.unselect()}))}}},20194:(e,t,i)=>{function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{w:()=>a});class a{constructor(e){this.timeMap=e,n(this,"_container",void 0),n(this,"__onLoadingStart",void 0),n(this,"__onLoadingStop",void 0),this.__onLoadingStart=()=>this._onLoadingStart(),this.__onLoadingStop=()=>this._onLoadingStop()}onAdd(){const e=document.createElement("div");return this._container=e,this.timeMap&&(this.timeMap.emitter.on("loading:start",this.__onLoadingStart),this.timeMap.emitter.on("loading:finish",this.__onLoadingStop)),e}onRemove(){if(this.timeMap&&(this.timeMap.emitter.off("loading:start",this.__onLoadingStart),this.timeMap.emitter.off("loading:finish",this.__onLoadingStop)),this._container){const e=this._container.parentNode;e&&e.removeChild(this._container)}}_onLoadingStart(){this._container&&(this._container.innerHTML="Loading...")}_onLoadingStop(){this._container&&(this._container.innerHTML="")}}},32175:(e,t,i)=>{i.d(t,{$m:()=>w,vq:()=>N,fI:()=>A,Hv:()=>b,KT:()=>f});const n=i.p+"e0badaf948f7f6e738fc.png";var a=i(97252),s=i(4147),r=i(6760);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class h{constructor(e){this.options=e,o(this,"_container",void 0),o(this,"_status",!0),this._status=void 0!==this.options.status?this.options.status:this._status,this._container=this._createContainer(),this._updateContainer()}getContainer(){return this._container}toggle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._status;this._status=e,this._updateContainer()}_createContainer(){const e=document.createElement("div");e.className="panel__toggler",this.options.className&&this.options.className.split(" ").forEach((t=>e.classList.add(t)));const t=this.options.toggleAction;return t&&e.addEventListener("click",(()=>{this.toggle(),t(this._status)})),e}_updateContainer(){const e=this._status?this.options.title:this.options.titleOff;e&&(this._container.title=e,this._status?this._container.classList.add("active"):this._container.classList.remove("active"))}}const d=i.p+"b9a9d5339ddd4f204b30.svg",l=i.p+"f8ffb55c124d065e4846.png",c=i.p+"3ca515dfa9b8e9c18027.png",p=`\n<div style="margin-top: 40px;"></div>\n<div class="partner_logos">\n<a href="https://www.runivers.ru" target="_blank"><img src="${d}" /></a>\n<a href="https://www.transneft.ru" target="_blank"><img src="${l}" /></a>\n<a href="https://histgeo.ru/laboratory.html" target="_blank"><img src="${c}" /></a>\n<a href="https://nextgis.ru" target="_blank"><img src="${n}" /></a>\n</div>\n\n<div style="margin-top: 20px;"></div>\n\n<div class="switch-about-language">\n<a class="switch-about-language-btn" name="en" href="#" style="font-size: 1.2rem; font-weight: bold;">\nEnglish version\n</a>\n</div>\n\n<div style="margin-top: 20px;"></div>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<h2>О проекте Границы России 850-2018 гг.</h2></P>\n\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<a href="https://www.runivers.ru" target="_blank">«Руниверс»</a> совместно с <a href="https://histgeo.ru/laboratory.html" target="_blank">Лабораторией исторической геоинформатики</a> Института всеобщей истории РАН и компанией <a href="http://nextgis.ru/" target="_blank">NextGIS</a> расширяет представленный ранее проект «Границы России 1462–2018 гг.» за счет увеличения хронологического охвата и добавления новых слоев. Теперь данный проект получает название «Границы Руси, России, СССР и РФ 850–2018 гг.».\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nЭтот картографический проект содержит геоданные о политических границах современной России и ее предшественников. Важнейшей возможностью, которую предоставляет данная карта, является выбор любого года в интервале карты. Год можно выбрать, кликнув мышкой в нужном месте ленты времени (в нижней части карты), либо запустив автоматическую прокрутку ленты времени с шагом в один год, либо, используя иконки + и – справа от ленты времени, сдвигаться на один год влево или вправо.\n</P>\n\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nПонятно, что начальная дата заявленного хронологического интервала совершенно условна. Она призвана показать расселение славянских племен в Восточной Европе накануне событий, известных как «призвание Рюрика». Более ранняя «нижняя» граница потребовала бы дополнительного отображения изменений в территориях, занятых отдельными восточнославянскими этническими группами, что с трудом выполнимо даже по результатам специальных исследований. Таким образом, новые слои политических границ позволяют охарактеризовать русскую историю до 1462 г.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nДля первого периода русской истории это сделано не только путем отображения внешних границ государственности, но и границ внутренних, принадлежащих, условно говоря, к «верхнему» административному уровню. При всей условности самого понятия «княжество» для первой половины восточноевропейской политической истории, о чем пишут современные историки (<a href="https://runivers.ru/include/doc/rusland/main_text_detail.php">https://runivers.ru/include/doc/rusland/main_text_detail.php</a>), формат динамической карты вынуждает к тому, чтобы упростить историческую реальность и придать политическому ландшафту «осязаемые» контуры в виде набора полигонов.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nК «верхнему» административному уровню отнесены княжества, обладавшие самостоятельностью, но входившие в ту или иную политическую систему (например, Великого княжества Владимирского). Удельные княжества относятся к территориальным единицам уровнем ниже, поэтому на карте не отображались.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nПонимая, что, с одной стороны, формы политического статуса территорий многообразны и что, с другой стороны, это многообразие необходимо свести к ограниченному числу вариантов при отображении на карте, мы выделили всего восемь различных статусов территории России или ее предшественников:</br>\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n1) Основная территория государства.</br>\n2) Территория под протекторатом, в вассальной зависимости или в сфере влияния.</br>\n3) Арендованная территория.</br>\n4) Территория в совместном владении.</br>\n5) Спорная территория.</br>\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nКроме того, в год изменения конфигурации границы соответствующий участок показан отдельным полигоном: как Новая территория (6) или, напротив, как Утраченная территория (7). Эти полигоны также снабжены маркерами, цифра на которых обозначает соответствующую позицию в списке территориальных изменений информационной панели. В связи с тем, что некоторые изменения территории имели место в разные месяцы года, иногда полигоны со статусами 6 и 7 задерживаются на карте и в следующем после события году.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n8) Для периода до 1462 г. — самостоятельная территория (княжество и т.п.), определяющая внутренние границы картографированного региона (например, Тверское княжество до 1382 г. внутри Великого княжества Владимирского).\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nЭта дифференциация отражена во всплывающем окне, вызываемом по клику мыши на любом объекте внутри политических границ. Следует помнить, что атрибуты, относящиеся к территориям статуса 1–5, по клику мыши появятся лишь в том случае, если в месте клика на карте не помещена территория со статусом 8. Заливка соответствующих полигонов передана пятью цветами: одним цветом показана основная территория государства и вновь присоединенные земли (статусы 1 и 6), другим цветом – земли, находящиеся в некоторой зависимости от него (статус 2), третьим – земли арендованные, спорные и находящиеся под совместным управлением с другими государствами (статусы 3–5). Утраченные территории обозначены четвертым цветом (статус 7), однако в силу ряда технических особенностей текущего алгоритма построения геометрий не все утраченные территории показаны на карте отдельным полигоном.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nВ центре каждого полигона, демонстрирующего приращение или потерю территории, помещен маркер, помогающий пользователю быстро найти соответствующее место на мелкомасштабной карте. По клику на маркер выдается информация о событии, приведшем к появлению данного территориального образования.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nПятый цвет — для территорий с внутренними границами. По клику на любой полигон можно получить данные о хронологическом диапазоне, в котором существовало данное территориальное образование, и его площади (в квадратных километрах).\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nМногие полигоны, относимые к статусу 2, отмечены во всплывающем окне как зона древнерусской колонизации. Эта формулировка подразумевает в основном контактные зоны между основным населением государства и населением, лишь вовлекаемым в отношения с ним. Постепенное продвижение древнерусского земледельческого населения на восток и юго-восток в конечном итоге приводило к включению освоенной территории в основной контур государства, но процесс этот не может быть однозначно зафиксирован в пространстве и времени.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nБолее подробное описание территорий, отображенных на карте, доступно по ссылке из окна, всплывающего по клику мышки на соответствующей территории, которая ведет на сайт «Руниверс».\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nКроме того, в новой версии проект дополнен рядом слоев. Слой городов показывает на карте расположение столиц и административных центров «верхнего уровня», расположенных по статусу на одну ступеньку ниже столиц. В наши задачи не входило отображение всех городов или хотя бы городов нижних административных уровней, а даты их появления и исчезновения на карте не совпадают с датами первого и последнего упоминаний. Хронологические рамки характеризуют лишь временной интервал, когда город служил административным центром «верхнего уровня». Поэтому большинство уездов XVII в. с карты исчезают в начале XVIII в., когда на смену уездам как основной единице административного деления приходят губернии. Появление на карте новых городов синхронно появлению соответствующего административного округа на «верхнем уровне» административной сетки.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nЕще один слой, добавленный на карту, в полном смысле экспериментальный. Он призван охарактеризовать конкретный участок границы по степени условности. Для этого сейчас используется три типа линий. Наиболее определенно участки границ локализуются по историческим документам, картографическим материалам XVIII—XXI в. или на основе специальных историко-географических исследований, которые на эти документы и материалы опираются (первый тип линий). Множество границ существовало на местности хотя бы на уровне общих представлений современников, однако по состоянию исторических свидетельств пока что не могут быть картографированы достаточно определенно (второй тип линий). Наконец, значительная часть границ (для домонгольской Руси практически все) во всех отношениях абстрактна — границы не только не могут быть сколь-нибудь определенно обозначены в настоящее время, но и не существовали ни в исторической реальности, ни в представлениях современников — насколько это можно предполагать исходя из наших актуальных представлений о прошлом.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nВ правом верхнем углу карты доступны три иконки-кнопки. Первая позволяет отключить современную картографическую подложку, две другие позволяют управлять отображением двух информационных блоков карты. В первом из них отображается имя правителя на избранный пользователем год, его титул или должность, годы нахождения у власти с отсылкой на отдельную страницу сайта с более подробными сведениями. В нижнем блоке указаны имевшие место в данном году территориальные изменения и приведена приблизительная площадь участков, которые добавились к территории государства и, наоборот, оказались утрачены.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nПри создании веб-ГИС «Границы Руси, России, СССР и РФ 850–2018 гг.» реализована концепция динамической карты. С точки зрения технической реализации проекта эта концепция является оригинальным решением, разработанным <a href="https://histgeo.ru/laboratory.html" target="_blank">Лабораторией исторической геоинформатики</a> Института всеобщей истории РАН совместно с <a href="http://nextgis.ru/" target="_blank">NextGIS</a>. Описание <a href="http://nextgis.ru/blog/runivers/" target="_blank">технической реализации</a> проекта.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nПрикладное значение данного проекта для использования в научных целях является отличительной его чертой. Подобные динамические карты, демонстрирующие изменения границ в прошлом, имеют в основном «образовательный» уклон и не предназначены для специалистов-историков. Но публикуемая динамическая карта открыта для постоянной корректировки и призвана в дальнейшем стать некой картографической подосновой для историка, применяющего ГИС-технологии для решения конкретных исследовательских задач.\n</P>\n<P ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\nО допущениях, особенностях методики и ограничениях применявшейся методики, технических особенностях проекта и перспективах его развития см. <a href="https://www.runivers.ru/granitsy-rossii/about/about_detailed/index.php" target="_blank">ПОДРОБНЕЕ .\n</P>\n`,m=`\n<div style="margin-top: 40px;"></div>\n<div class="partner_logos">\n<a href="https://www.runivers.ru" target="_blank"><img src="${d}" /></a>\n<a href="https://www.transneft.ru" target="_blank"><img src="${l}" /></a>\n<a href="https://histgeo.ru/laboratory.html" target="_blank"><img src="${c}" /></a>\n<a href="https://nextgis.com" target="_blank"><img src="${n}" /></a>\n</div>\n<div style="margin-top: 40px;"></div>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<h2>Russia’s Borders from 1462 through 2018’ Project</h2></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n\n<SPAN LANG="en-EN"><a href="https://www.runivers.ru" target="_blank">Runivers</a>\n\npresents ‘Russia’s Borders from 1462 through 2018’ –\na project designed in collaboration with the\n<a href="https://histgeo.ru/laboratory.html" target="_blank">\nLaboratory of Historical Geomatics</a> at the Institute of World History\nof the Russian Academy of Sciences (RAS) and\n<a href="http://nextgis.com" target="_blank">NextGIS Ltd.</a>\n</SPAN></P>\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nThis cartographic project contains geographical information on the political borders\nof the contemporary Russian Federation and its predecessor states.\nAn opportunity to select any year in the 1462 to 2018 time bracket is a crucial option of this map.\nTo choose the needed year, the users either click at the needed point on the timeline (at the bottom of the map)\nor launch its step-by-step automatic rewinding or else use the + or –\nicons to the right of the timeline, thus moving one year backwards or forwards.\n</SPAN></P>\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<A NAME="OLE_LINK210"></A><A NAME="OLE_LINK209"></A>\n<SPAN LANG="en-EN">\nThe realization that the forms of a political status of lands are multiple and that,\non the other hand, this diversity should be reduced to a limited number of versions for\ndepiction on the map has prompted us to single out seven different statuses of the territory\nof today’s Russia and its predecessors.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0in">\n<SPAN LANG="en-EN">\n1) The mainland of the state.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0in">\n<SPAN LANG="en-EN">\n2) A territory under protectorate, vassal allegiance or in the sphere of influence.\n</SPAN></P>\n<P LANG="en-EN" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0in">\n3) A leased territory.\n</P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0in">\n<SPAN LANG="en-EN">\n4) A territory in joint possession.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0in">\n<SPAN LANG="en-EN">\n5) A litigious territory.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<A NAME="OLE_LINK222"></A><A NAME="OLE_LINK221"></A>\n<SPAN LANG="en-EN">\nChanges in the configuration of the border in relevant years are shown in separate polygons as: 6.\nthe newly acquired territories or, 7. lost territories.\nThese polygons have the tokens, the numbers on which correspond to positions in the list of\nterritorial changes found in the info bar.\nTerritorial changes occurred in different months of the year – sometimes in the first half of the year,\nand sometime in the second half, and that is why the polygons with statuses 6 and 7 sometimes stay on\nand get over to the year that followed a specified event.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nThe differentiation is reflected in popup windows,\nwhich the users can bring up by clicking at any object inside the political borders.\nThe polygons are filled with four colors. One color shows the mainland of the state and the newly\nincorporated lands (statuses 1 and 6); the second color marks the lands that have a certain degree\nof dependence on the state (status 2); the third color brings out the leased and litigious areas or\nthe lands governed jointly with other countries (statuses 3 and 5).\nThe lost territories (status 7) are marked with the fourth color but owing to certain technology\npeculiarities of the current algorithm of geometrical arrangements formation some of the lost territories\nare not displayed on the map with the aid of separate polygons. A click at any polygon will call up\nthe information on the chronological range, in which a territorial entity existed, and on its size (in sq. km).\n</SPAN></P>\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nPlaced in the center of each polygon is a token that helps the users find an appropriate\nlocation on a small-scale map. A click at the token will retrieve the data on the event\nthat resulted in the formation of the specific territorial entity.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nThree button icons are available in the upper right-hand corner of the map.\nThe first one switches the contemporary basemap off, while two others make it\npossible to handle the presentation of two data units of the map.\nThe first unit shows the name, title/ official position and the years in office of the person\nwho ruled the territory in the year chosen by the user. It also contains a reference to a special page\nat the website that offers detailed information. The lower data unit provides information\non the territorial changes in the selected year, as well as on an approximate size of the lands\nthat were incorporated into the nation or, vice versa, were lost.\n</SPAN></P>\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\n‘The Borders of the Duchy of Muscovy/ Czardom of Russia/ Russian Empire/ USSR/\nRussian Federation from 1462 through 2018’ web GIS rests on the concept of a dynamic map.\nAs regards the technical implementation, this concept embodies an original solution developed at the\n<a href="https://histgeo.ru/laboratory.html" target="_blank">Laboratory of Historical Geomatics</a>\nof the RAS Institute of World History in cooperation with\n<a href="http://nextgis.com" target="_blank">NextGIS Ltd.</a>\n</SPAN></P>\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nPractical applicability of this project for research purposes makes it stand out among other projects of this kind.\nThe dynamic maps displaying the past changes of state borders most typically have an educational\nfocus and historians do not have a chance to amend them after expert debates.\nConversely, the dynamic map released now is open for future amendments and is called upon\nto serve as an instrumental cartographic aid for the scholars of history who use GIS technologies\nto attain specified research objectives.\n\n\n<P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n<SPAN LANG="en-EN">\nTechnical implementation  <a href="http://nextgis.com/blog/runivers/" target="_blank">description</a>.\n</SPAN></P>\n`;function u(e){const t="baselayer";return new h({className:"baselayer__toggler",title:"Скрыть подложку",titleOff:"Показать подложку",toggleAction:i=>{i?e.app.webMap.showLayer(t):e.app.webMap.hideLayer(t)}})}function y(e){const t=new a.Z(e);return e&&e.template&&t.options.template===e.template||t.updateContent(e.template),t.show(),t}function _(e){const t=e.yearsStatPanelControl;if(t){const e=new h({className:"years__toggler",title:"Скрыть панель изменения в территориальном составе",titleOff:"Показать панель изменения в территориальном составе",toggleAction:e=>{e?(t._blocked=!1,t.show()):(t.hide(),t._blocked=!0)}});return t.emitter.on("toggle",(t=>{e.toggle(t)})),e}}function g(e){const t=e.periodsPanelControl;if(t){const e=new h({className:"period__toggler",title:"Скрыть панель правителей",titleOff:"Показать панель правителей",toggleAction:e=>{e?t.show():t.hide()}});return t.emitter.on("toggle",(t=>{e.toggle(t)})),e}}function L(e){const t=e.legendPanel;if(t){const e=new h({className:"legend__toggler",title:"Скрыть легенду",titleOff:"Показать легенду",toggleAction:e=>{e?t.show():t.hide()}});return t.emitter.on("toggle",(t=>{e.toggle(t)})),e}}function f(e){const t=document.createElement("div");t.className="switcher-panel-control",[L(e),g(e),_(e),u(e)].forEach((e=>e&&t.appendChild(e.getContainer())));const i=new r.s({addClass:"panel-links"});return i.updateBody(t),i}function b(){const e=document.createElement("div");e.innerHTML='\n    <div class="social-links">\n      <a href="http://twitter.com/runivers" class="social__logo twitter"></a>\n      <a href="http://www.facebook.com/Runiverse.ru" class="social__logo facebook"></a>\n      <a href="http://vk.com/public35690973" class="social__logo vkontakte"></a>\n    </div>\n  ';const t=new r.s({addClass:"panel-links"});return t.updateBody(e),t}function v(e){return`\n    <P LANG="en-GB" CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0.17in">\n      <SPAN LANG="ru-RU">${e}</SPAN>\n    </P>`}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ru";const i=e.webMap.getAttributions({onlyVisible:!1,onlyBaselayer:!0}),n={ru:p,en:m};let s=n[t];if(i.length){let e="ru"===t?"Использована картографическая подложка: ":"The basemap used: ";i.forEach((t=>{e+=t})),s+=v(e)}const r=document.createElement("div");r.innerHTML=s;const o=r.getElementsByClassName("switch-about-language-btn")[0];o&&(o.onclick=()=>{a.Z.clean(),S(e,o.name)}),y({template:r})}function w(e){const t=document.createElement("a");return t.className="about_icon",t.setAttribute("href","#"),t.innerHTML="i",t.onclick=()=>{S(e,"ru")},t}function N(e){const t=document.createElement("div");t.innerHTML='\n  <a href="https://www.runivers.ru"\n    title="Электронная  энциклопедия и библиотека Руниверс"\n    class="affiliated-logo runiver__logo__min" target="_blank"\n  ></a>\n  <a href="https://histgeo.ru/laboratory.html"\n    class="affiliated-logo laboratory__logo__min" target="_blank"\n    title="Лаборатория исторической геоинформатики"\n  ></a>\n  <a href="https://www.transneft.ru"\n    class="affiliated-logo transneft__logo__min" target="_blank"\n    title="ПАО «Транснефть»"\n  ></a>\n  <a href="https://nextgis.ru"\n    class="affiliated-logo nextgis__logo__min" target="_blank"\n    title="Разработка ГИС и проекты"\n  ></a>\n  <a href="#" class="affiliated-logo settings__logo__min" target="_blank" title="Настройки"></a>\n  ';const i=t.getElementsByClassName("settings__logo__min")[0];return i&&(i.onclick=t=>{t.preventDefault(),function(e){const t=document.createElement("div"),i=document.createElement("div");i.className="settings-dialog__header",i.innerHTML="\n    <h2>Настройки</h2>\n  ",t.appendChild(i);const n=e.slider;[{name:"animationDelay",label:"Задержка анимации, мс",type:"number"},{name:"step",label:"Шаг изменения года",type:"number"},{name:"animationStep",label:"Шаг изменения года (анимация)",type:"number"}].forEach((e=>{const i=e.name+"-"+Math.round(1e4*Math.random()),a=document.createElement("label");a.className="settings-dialog__input-block",a.innerHTML=`<div class="settings-dialog__input-block--label">${e.label}: </div>\n      <input class="${i}" class=type=${e.type} value=${n.options[e.name]}>\n      </input>\n    `;const s=a.getElementsByClassName(i)[0];s.addEventListener("input",(()=>{const t="number"===e.type?parseInt(s.value,10):s.value;Object.defineProperty(n.options,e.name,{value:t,enumerable:!0})})),t.appendChild(a)}));const a=e.controls.legendPanel&&e.controls.legendPanel.createLegendBlock(!0);a&&t.appendChild(a);const r=document.createElement("div");r.className="settings-dialog__read-more",r.innerHTML=`\n    Описание технической реализации проекта доступно по\n    <a href="http://nextgis.ru/blog/runivers/" target="_blank">ссылке</a>.\n    <div>v.${s.i8}</div>\n  `,t.appendChild(r),y({template:t})}(e)}),t}function A(e){return e.app.webMap.createButtonControl({addClass:"maplibregl-ctrl-icon maplibregl-ctrl-home",onClick:()=>e.app.options.bounds&&e.app.webMap.fitBounds(e.app.options.bounds)})}},4662:(e,t,i)=>{i.d(t,{Y:()=>o});var n=i(6767),a=i.n(n),s=i(6760);const r={addClass:"legend-panel"};class o extends s.s{constructor(e){super({...r,...e}),this.options=e,this._createLegendBody(),this._addEventsListener()}createLegendBlock(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.createElement("div");t.className="panel-body__legend";const i=this.options.colors;return i&&Object.values(i).forEach((i=>{i.forEach((i=>{t.appendChild(this._createLegendItem(i,e))}))})),t}_createLegendBody(){const e=this.createLegendBlock(),t=document.createElement("div");return t.className="panel-body__legend--button",t.innerHTML='\n    <div><a\n      href="https://www.runivers.ru/granitsy-rossii/charts/index.php"\n      target=\'_blank\'\n      class="btn panel-button">ГРАФИК ИЗМЕНЕНИЯ ТЕРРИТОРИИ\n    </a></div>\n    <div><a\n      href="https://runivers.ru/doc/rusland/zemli-i-knyazhestva/"\n      target=\'_blank\'\n      class="btn panel-button">Схема земель и княжеств <div class="link-button subtitle">средневековой Руси</div>\n    </a></div>\n    ',e.appendChild(t),this.updateBody(e),e}_createLegendItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=document.createElement("div");i.className="panel-body__legend--block";const[n,s,r]=e,o="string"==typeof s?s:s.color,h="string"!=typeof s&&s.type||"fill";if(t)this._createInteractiveBlock(i,n,o,r);else{const e=new(a())(o),t=document.createElement("div");t.className="panel-body__legend--color "+h,t.style.backgroundColor=String(e.fade(.3)),t.style.border="2px solid "+e.darken(.5),i.appendChild(t);const n=document.createElement("div");n.className="panel-body__legend--name",n.innerHTML=`${r}`,i.appendChild(n)}return i}_createInteractiveBlock(e,t,i,n){const a=document.createElement("input");a.setAttribute("type","color"),a.className="editable-legend__color-input",a.value=i,e.appendChild(a);const s=e=>` - ${n} (${e})`,r=document.createElement("span");r.className="panel-body__legend--name",r.innerHTML=s(i);const o=this.options.colors;a.onchange=()=>{if(o){const e=[];Object.values(o).forEach((t=>t.forEach((t=>e.push(t)))));const i=e.find((e=>e[0]===t));i&&(i[1]=a.value,r.innerHTML=s(a.value),this.emitter.emit("change",this.options.colors))}},e.appendChild(r)}_addEventsListener(){this.emitter.on("change",(()=>{this._createLegendBody()}))}}},6760:(e,t,i)=>{i.d(t,{s:()=>r});var n=i(97252),a=i(17187);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,s(this,"emitter",new a.EventEmitter),s(this,"isHide",!1),s(this,"_blocked",!1),s(this,"webMap",void 0),s(this,"_header",void 0),s(this,"_container",void 0),s(this,"_body",void 0),s(this,"_dialog",void 0),this.webMap=this.options.webMap,this._container=this._createContainer()}getContainer(){return this._container}onAdd(e){return this.webMap=e,this._container}onRemove(){if(this._container){const e=this._container.parentNode;e&&e.removeChild(this._container)}}updateBody(e){this._cleanBody(),this._body&&("string"==typeof e?this._body.innerHTML=e:e instanceof HTMLElement&&this._body.appendChild(e))}hide(){this.isHide=!0,this._container&&this._container.classList.add("panel-hide"),this.emitter.emit("toggle",!1)}show(){this._blocked||(this.isHide=!1,this._container&&this._container.classList.remove("panel-hide"),this.emitter.emit("toggle",!0))}block(){this._blocked=!0}unBlock(){this._blocked=!1}createControlButton(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Подробнее";const i=document.createElement("button");return i.className="btn panel-button",i.innerHTML=t,i.onclick=e,i}createRefButton(e,t){return this.createControlButton((()=>window.open(e,"_blank")),t)}openDialog(e){this._dialog||(this._dialog=new n.Z(e));const t=e&&e.template;t&&(this._dialog.options.template===t||this._dialog.updateContent(t)),this._dialog.show()}closeDialog(){this._dialog&&this._dialog.close()}_cleanBody(){this._body&&(this._body.innerHTML="")}_createContainer(){const e=document.createElement("div");return e.className="maplibregl-ctrl panel",this.options.addClass&&this.options.addClass.split(" ").forEach((t=>e.classList.add(t))),this.options.headerText,e.appendChild(this._createBody()),e}_createHeader(){const e=document.createElement("div");return e.className="panel-header",this.options.headerText&&(e.innerHTML=this.options.headerText),this._header=e,e}_createBody(){const e=document.createElement("div");return e.className="panel-body",this._body=e,e}}},1864:(e,t,i)=>{i.d(t,{O:()=>o});var n=i(6760),a=i(95096);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const r={headerText:"Правители",addClass:"period-panel"};class o extends n.s{constructor(e){super(Object.assign({},r,e)),s(this,"period",void 0),s(this,"areaStat",void 0)}hide(){if(super.hide(),this.webMap){const e=this.webMap.getContainer();e&&e.classList.remove("period-panel")}}show(){if(super.show(),!this.isHide&&this.webMap){const e=this.webMap.getContainer();e&&e.classList.add("period-panel")}}updatePeriod(e,t){if(this.closeDialog(),e){const i=this.period,n=this.areaStat&&this.areaStat.area,a=t&&t.area;i===e&&n===a||(this.updateBody(this._createPeriodBody(e,t)),this.period=e,this.areaStat=t)}else this.updateBody('<div class="panel-body__period empty">В этом году изменений территории не было</div>'),this.period=void 0}_createPeriodBody(e,t){const i=document.createElement("div");i.className="panel-body__period";const n=document.createElement("div");let s="";e.img_link&&(s=`<div\n        class="panel-body__period--image" style="background-image: url('${e.img_link}');">\n      </div>`),n.innerHTML=`\n      ${s||""}\n      <div class="panel-body__period--name">${e.name}</div>\n      <div class="panel-body__period--period">${e.years_from} – ${e.years_to} гг.</div>\n      <div class="panel-body__period--description">${e.description}</div>\n      ${t?`\n      <div class="panel-body__period--description panel-body__period--area_wrap">\n        Общая площадь: <span class="panel-body__period--area">\n          ${(0,a.S)(t.area)}\n        </span>\n      </div>\n      `:""}\n    `,i.appendChild(n);const r=e.detail_link&&this.createRefButton(e.detail_link);return r&&i.appendChild(r),i}}},7391:(e,t,i)=>{i.d(t,{x:()=>h});var n=i(48651),a=i(6760),s=i(95096);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const o={headerText:"Изменения в территориальном составе",addClass:"stat-panel"};class h extends a.s{constructor(e){super({...o,...e}),r(this,"yearStat",void 0),r(this,"yearStats",void 0),r(this,"areaStat",void 0)}hide(){if(super.hide(),this.webMap){const e=this.webMap.getContainer();e&&e.classList.remove("years-panel")}}show(){if(super.show(),!this.isHide&&this.webMap){const e=this.webMap.getContainer();e&&e.classList.add("years-panel")}}updateYearStats(e,t){this.yearStats=e,this.areaStat=t,this.updateYearStat(this.yearStats[0])}updateYearStat(e){const t=this.yearStat,i=this.getContainer();i&&(i.classList.remove("gain"),i.classList.remove("lost")),e?t!==e&&(this.yearStat=e,this.updateBody(this._createPeriodBody(e))):(this.updateBody('<div class="panel-body__period empty">В этом году изменений территории не было</div>'),this.yearStat=void 0),this.emitter.emit("update",{yearStat:this.yearStat})}_createPeriodBody(e){const t=document.createElement("div");t.className="panel-body__yearstat";const i=document.createElement("div");if(i.className="panel-body__period--year",i.innerHTML=`${e.year} г.`,t.appendChild(i),this.areaStat){const e=this.areaStat.plus;e&&t.appendChild(this._createGainBlock(e));const i=this.areaStat.minus,n=this.getContainer();i&&t.appendChild(this._createGainBlock(i,!0)),n&&n.classList.add(i?"lost":"gain")}this.yearStats&&this.yearStats.length>1&&t.appendChild(this._createStateSwitcher());const n=this._createDescriptionBlock(e);n&&t.appendChild(n);const a=e.description_long;if(a){const e=document.createElement("div");e.className="panel-body__period--description",e.innerHTML=`${a}`;const i=document.createElement("div");i.className="button-wrap",i.appendChild(this.createControlButton((()=>this.openDialog({template:e})))),t.appendChild(i)}return t}_createStateSwitcher(){const e=document.createElement("div");e.className="panel-body__period--slider";const t=this.yearStats,i=this.yearStat;if(i&&t){const a=i.numb,s=(0,n.r)(i.count)?i.count:t.length;if(s&&a&&s>1&&s>=a){const n=t.indexOf(i),r=0===n,o=t.length,h=n===o-1,d=(e,i)=>{const a=document.createElement("a");return a.setAttribute("href","#"),a.className=(e?"panel_slider prev":"panel_slider next")+(i?"":" hidden"),i&&(a.onclick=i=>{i.preventDefault();const a=t[e?n-1:n+1];this.updateYearStat(a)}),a};e.appendChild(d(!0,!r));const l=document.createElement("div");l.className="panel_slider-counter",l.innerHTML=`${a} из ${s}`,e.appendChild(l),e.appendChild(d(!1,!h))}}return e}_createDescriptionBlock(e){const t=document.createElement("div");if(e.description_short)return t.innerHTML=`<div class="panel-body__period--description">${e.description_short}</div>`,t}_createGainBlock(e,t){const i=document.createElement("div");return i.className="panel-body__yearstat--gain "+(t?"lost":"gained"),i.innerHTML=(t?"-":"+")+(0,s.S)(e),i}}},81175:(e,t,i)=>{e.exports=i.p+"1dd64463b51c19fd3657.svg"},82077:(e,t,i)=>{e.exports=i.p+"77159e02d8b565a72bd3.svg"},51181:e=>{e.exports=JSON.parse('{"FH":"https://gis.runivers.ru","tk":6541,"vg":{"base":[[1,"#33b850","Основная территория государства",[1,6]],[2,"#527800","Самостоятельные территории (княжества и т.п.)",[8]],[3,"#79d254","Территория под протекторатом, в вассальной зависимости или в сфере влияния",[2]],[4,"#01d0a4","Аренда, совместное владение, спорная территория",[3,4,5]],[5,"#a3ada3","Утраченная территория",[7]]],"lines":[[6,{"width":2.06,"color":"rgba(132, 73, 58, 1.00)","type":"line"},"Определенно локализуемая граница",[1]],[7,{"width":2.06,"color":"rgba(132, 73, 58, 0.30)","type":"line"},"Граница, локализованная приблизительно",[2]],[8,{"width":3.26,"color":"rgba(255,255,255, 0.25)","type":"line"},"Условная граница",[3]]]}}')},4147:e=>{e.exports={i8:"5.0.0"}}}]);
//# sourceMappingURL=main-9a8b795af311aab.js.map