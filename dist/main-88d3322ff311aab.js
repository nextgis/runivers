"use strict";(globalThis.webpackChunkrussia_history=globalThis.webpackChunkrussia_history||[]).push([[517],{58497:(t,e,i)=>{i.d(e,{z:()=>_});var o=i(17187),n=i(74211),s=i.n(n),a=i(76018),l=i.n(a),r=i(81175),h=i(82077);function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const p={type:"range",min:0,max:100,step:1,animationStep:1,value:50,animationDelay:200,filterPips:(t,e)=>1===e?1:t%100?t%10?-1:0:1};class _{constructor(t){this.options=t,d(this,"emitter",new o.EventEmitter),d(this,"map",void 0),d(this,"_animationStepInput",void 0),d(this,"_sliderContainer",void 0),d(this,"_slider",void 0),d(this,"_playerControl",void 0),d(this,"_playerControlPrevBtn",void 0),d(this,"_playerControlNextBtn",void 0),d(this,"_container",void 0),d(this,"_input",void 0),d(this,"_animationStatus",void 0),this.options=Object.assign({},p,t),this.options.animationStep=this.options.animationStep||this.options.step}onAdd(t){return this.map=t,this._container=this._createContainer(),this._container}onRemove(){}_createContainer(){const t=document.createElement("div");return t.className="maplibregl-ctrl slider-control",t.appendChild(this._createSliderContainer()),(void 0===this.options.playerControl||this.options.playerControl)&&t.appendChild(this._createNavigationContainer()),t}_createValueInput(){const t=this._createLabeledInput({type:"number",value:this.options.value}),e=t.input;return e.onchange=()=>{this._onChange(this._getAllowedValue(Number(e.value)))},this._input=e,t.label}_createAnimationStepInput(){const t=this._createLabeledInput({type:"number",label:"animation step",value:this.options.animationStep}),e=t.input,i=this.options;return e.onchange=()=>{let t=Number(e.value);t=t<=0?i.animationStep:t>i.max?i.max:t,e.value=String(t),i.animationStep=t},this._animationStepInput=e,t.label}_createAnimationDelayInput(){const t=this._createLabeledInput({type:"number",label:"amimation delay",value:this.options.animationDelay}),e=t.input;return e.onchange=()=>{let t=Number(e.value);t=t<=0?1:t,this.options.animationDelay=t},t.label}_createSliderContainer(){const t=document.createElement("span");t.className="slider-control-range";const e=document.createElement("div");t.appendChild(e);const{min:i,max:o,step:n}=this.options,a=s().create(e,{range:{min:i,max:o},step:n,tooltips:[l()({decimals:0})],start:[this.options.value],pips:void 0!==this.options.pips?this.options.pips:{mode:"steps",density:3,filter:this.options.filterPips}});return a.on("change",((t,e)=>{if(Array.isArray(t)){const e=t[0],i="string"==typeof e?parseInt(e,10):e;this._onSliderClick(i)}})),a.target.addEventListener("click",(()=>{this.stopAnimation()}),!0),this._sliderContainer=t,this._slider=a,t}_createPlayerContainer(){const t=document.createElement("div");t.className="slider-control-block slider-control-player";const e=document.createElement("button");return e.className="player-button",e.onclick=()=>{this._toggleAnimation()},t.appendChild(e),this._playerControl=e,t}_createPlayerButton(){const t=document.createElement("button");return t.className="player-button",t.onclick=()=>{this._toggleAnimation()},this._playerControl=t,t}_createNavigationContainer(){const t=document.createElement("div");t.className="slider-control-block slider-control-steps";const e=e=>{const i=document.createElement("button");return i.className="slider-control-steps-btn",i.innerHTML=`\n        <img src="${e?h:r}" width="24" height="24"/>\n      `,t.appendChild(i),e&&t.appendChild(this._createPlayerButton()),i.onclick=()=>{this._animationStatus||this._stepReady(((t,e,i)=>{"boolean"!=typeof t?(e&&e(),this._nextStep(t)):i&&i()}),e,this.options.step)},i};return this._playerControlPrevBtn=e(!0),this._playerControlNextBtn=e(),t}_createLabeledInput(t){t=t||{};const e=document.createElement("input");e.className="slider-control-input",t.type&&e.setAttribute("type",t.type),t.value&&(e.value=t.value);const i=document.createElement(t.label?"label":"div");return i.className="slider-control-block",t.label&&(i.innerHTML=t.label+":"),i.appendChild(e),{label:i,input:e}}startAnimathin(){this._toggleAnimation(!0)}stopAnimation(){this._toggleAnimation(!1)}_onSliderClick(t){this._animationStatus&&this.stopAnimation(),this._onChange(t)}_onChange(t){this._slider&&this._slider.set(t),this._input&&(this._input.value=String(t)),this.emitter.emit("change",t)}_toggleAnimation(t){t=void 0!==t?t:!this._animationStatus,this._animationStatus=t,this._playerControl&&this._playerControl.classList[this._animationStatus?"add":"remove"]("paused"),t?(this._startAnimation(),this.emitter.emit("animationStarted")):this._stopAnimation()}_startAnimation(){if(this._animationStatus){this._disableControlBtn();const t=(new Date).getTime();this._stepReady(((e,i,o)=>{if("boolean"!=typeof e&&e<this.options.max&&e>this.options.min&&this._animationStatus){const n=(new Date).getTime()-t;let s=this.options.animationDelay-n;s=s>=0?s:0,setTimeout((()=>{this._animationStatus?(i&&i(),this._nextStep(e),this._startAnimation()):(this.emitter.emit("animationStopped"),o&&o())}),s)}else this.emitter.emit("animationStopped"),o&&o(),this.stopAnimation()}))}else this.stopAnimation()}_nextStep(t){this._slider&&this._slider.set(t),this._onChange(t)}_stepReady(t,e,i){const o=this._getNextValue(e,i),n=this.options.value<=this.options.max&&this.options.value>=this.options.min;o&&n?(this.options.value=o,this.options.stepReady?this.options.stepReady(o,t,e):t(o)):t(!1)}_getAllowedValue(t){return t<=this.options.min?this.options.min:t>this.options.max?this.options.max:t}_getNextValue(t,e){if(this._slider){const i=this._slider.get();if("string"==typeof i){const o=parseInt(i,10),n=e||this.options.animationStep,s=t?o-n:o+n;return this._getAllowedValue(s)}}}_stopAnimation(){this._enableControlBtn()}_disableControlBtn(){[this._playerControlNextBtn,this._playerControlPrevBtn].forEach((t=>{t&&(t.classList.add("disables"),t.setAttribute("disabled","true"))}))}_enableControlBtn(){[this._playerControlNextBtn,this._playerControlPrevBtn].forEach((t=>{t&&(t.classList.remove("disables"),t.removeAttribute("disabled"))}))}}},95060:(t,e,i)=>{i.d(e,{Z:()=>h});var o=i(32175),n=i(4662),s=i(1864),a=i(7391),l=i(20194);function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class h{constructor(t){this.app=t,r(this,"periodsPanelControl",void 0),r(this,"yearsStatPanelControl",void 0),r(this,"legendPanel",void 0),r(this,"isMobile",!1),r(this,"_socialLinksPanel",void 0),r(this,"_switchersPanel",void 0),r(this,"_homeBtnPanel",void 0),r(this,"_zoomControl",void 0),r(this,"_loadingControl",void 0),r(this,"_attributions",void 0),r(this,"_installedControls",[]),r(this,"_mobileTogglePanels",[]),r(this,"_openPanels",[]),r(this,"_eventBindings",{onMapClick:()=>null}),r(this,"_mobSizeConst",{height:700,width:650}),r(this,"_togglerEvents",[]),this._eventBindings.onMapClick=()=>this._onMapClick(),this.checkMobile(),this.initControls(),this._updateTimeSlider(),this._updateMapEvents(),this._addEventsListeners()}updateControls(){this.removeControls();const t=this.app.webMap.getContainer();t&&(this.isMobile?(this._hideAllPanels(),t.classList.add("mobile"),this._addMobileControls(),this._addPanelToggleListeners()):(this._mobileTogglePanels.forEach((t=>{-1!==this._openPanels.indexOf(t)&&t.show()})),this._removePanelToggleListener(),t.classList.remove("mobile"),this._addFullSizeControls()))}removeControls(){this._installedControls.forEach((t=>{this.app.webMap.removeControl(t)})),this._installedControls=[]}async initControls(){this.periodsPanelControl=new s.O({webMap:this.app.webMap}),this.yearsStatPanelControl=new a.x({webMap:this.app.webMap}),this.legendPanel=new n.Y({colors:this.app.options.lineColorLegend}),this._socialLinksPanel=(0,o.Hv)(),this._switchersPanel=(0,o.KT)(this),this._homeBtnPanel=(0,o.fI)(this),this._zoomControl=this.app.webMap.getControl("ZOOM",{zoomInTitle:"Приблизить",zoomOutTitle:"Отдалить"}),this._attributions=this.app.webMap.getControl("ATTRIBUTION"),this._mobileTogglePanels=[this.periodsPanelControl,this.yearsStatPanelControl],this.legendPanel&&(this._mobileTogglePanels.push(this.legendPanel),this.legendPanel.emitter.on("change",(t=>this.app.updateLayersColor()))),this._mobileTogglePanels.forEach((t=>t.show())),this._loadingControl=new l.w(this.app.timeMap)}async _addControl(t,e,i){const o=await this.app.webMap.addControl(t,e,i);o&&this._installedControls.push(o)}async _addFullSizeControls(){await this._addControl(this.legendPanel,"top-left"),await this._addControl(this._switchersPanel,"top-right"),await this._addControl(this.periodsPanelControl,"top-right"),await this._addControl(this.yearsStatPanelControl,"top-right"),await this._addControl(this._attributions,"bottom-left"),await this._addControl(this._socialLinksPanel,"bottom-left"),await this._addControl(this._homeBtnPanel,"bottom-left"),await this._addControl(this._zoomControl,"bottom-left"),await this._addControl(this._loadingControl,"bottom-right"),this._manualControlMove()}async _addMobileControls(){await this._addControl(this._switchersPanel,"top-left"),await this._addControl(this.legendPanel,"bottom-right"),await this._addControl(this.yearsStatPanelControl,"bottom-right"),await this._addControl(this.periodsPanelControl,"bottom-right"),await this._addControl(this._zoomControl,"top-left"),await this._addControl(this._homeBtnPanel,"top-left"),await this._addControl(this._attributions,"bottom-left"),await this._addControl(this._socialLinksPanel,"bottom-left"),this._manualControlMove()}_manualControlMove(){const t=this.app.webMap.getContainer();if(t){const e=t.querySelector(".maplibregl-ctrl.maplibregl-ctrl-attrib");e&&e.parentNode&&(e.parentNode.removeChild(e),t.appendChild(e))}}checkMobile(){return this.isMobile=window.innerWidth<=this._mobSizeConst.width||window.innerHeight<=this._mobSizeConst.height,this.isMobile}_updateMapEvents(){this.isMobile?this._addMapClickEvent():this._removeMapClickEvent()}_updateTimeSlider(){const t=document.querySelectorAll(".noUi-marker.noUi-marker-horizontal.noUi-marker-normal");let e=Array.from(t);const i=document.querySelectorAll(".noUi-value.noUi-value-horizontal.noUi-value-large");e=e.concat([i[1],i[i.length-2]]),window.innerWidth<=this._mobSizeConst.width?e.forEach((t=>{t.style.visibility="hidden"})):e.forEach((t=>{t.style.visibility=""}))}_onPanelToggle(t){this._removePanelToggleListener();const e=t.isHide;this._hideAllPanels(),e||t.show(),this._addPanelToggleListeners()}_addPanelToggleListeners(){this._removePanelToggleListener(),this._togglerEvents=[],this._mobileTogglePanels.forEach((t=>{const e=()=>this._onPanelToggle(t);this._togglerEvents.push([t,e]),t.emitter.on("toggle",e)}))}_removePanelToggleListener(){this._mobileTogglePanels.forEach((t=>{const e=this._togglerEvents.find((e=>e[0]===t));e&&t.emitter.removeListener("toggle",e[1])}))}_onMapClick(){this.isMobile&&this._hideAllPanels()}_onWindowResize(){const t=this.isMobile;this.checkMobile(),t!==this.isMobile&&this.updateControls(),this._updateTimeSlider(),this._updateMapEvents()}_addEventsListeners(){window.addEventListener("resize",(()=>this._onWindowResize()),!1)}_hideAllPanels(){this._openPanels=[],this._mobileTogglePanels.forEach((t=>{t.isHide||this._openPanels.push(t),t.hide()}))}_addMapClickEvent(){this.app.webMap.emitter.on("click",this._eventBindings.onMapClick)}_removeMapClickEvent(){this.app.webMap.emitter.removeListener("click",this._eventBindings.onMapClick)}}}}]);
//# sourceMappingURL=main-88d3322ff311aab.js.map