"use strict";(globalThis.webpackChunkrussia_history=globalThis.webpackChunkrussia_history||[]).push([[853],{97252:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(90908);function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class r{constructor(t){o(this,"options",{template:"\n      <p>This is dialog!</p>\n    ",closeBtn:!0,closeBtnTemplate:'\n  <a href="#">\n    <svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">\n      </path>\n      <path d="M0 0h24v24H0z" fill="none"></path>\n    </svg>\n  </a>\n'}),o(this,"_dialog",void 0),o(this,"_isNativeDialog",void 0),o(this,"_content",void 0),o(this,"_parent",void 0),o(this,"_closeBtn",void 0),this._dialog=document.createElement("dialog"),r.dialogs.push(this),this._dialog.className="dialog-component",this.options={...this.options,...t},this._parent=this.options.parent||document.body,this._isNativeDialog=!!this._dialog.showModal,this._isNativeDialog||(s.Z.registerDialog(this._dialog),this._dialog.classList.add("polyfilled")),this.options.closeBtn&&(this._closeBtn=this._createCloseBtn()),this._content=document.createElement("div"),this._dialog.appendChild(this._content),this.updateContent(),this._parent&&this._parent.appendChild(this._dialog),this._addEventsListeners()}static clean(){r.dialogs.forEach((t=>t.destroy()))}getContainer(){return this._dialog}show(){this._dialog.showModal()}close(){this._dialog.close()}destroy(){this.close(),this._dialog.remove()}updateContent(t){!t&&this.options.template&&(t=this.options.template),t&&this._addContent(t,this._content)}_createCloseBtn(){const t=this.options.closeBtnTemplate;if(t){const e=document.createElement("div");return e.className="dialog-component__close",this._dialog.appendChild(e),this._addContent(t,e),e.addEventListener("click",(t=>{t.stopPropagation(),this.close()})),e}}_addContent(t,e){"string"==typeof t?e.innerHTML=t:t instanceof HTMLElement&&(e.innerHTML="",e.appendChild(t))}_addEventsListeners(){this._closeBtn&&this._closeBtn.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.close()})),this.options.openers&&[].forEach.call(this.options.openers,(t=>{t.onclick=t=>{t.preventDefault(),this.show()}})),this._dialog.addEventListener("close",(()=>{})),this._dialog.addEventListener("cancel",(()=>{}))}}o(r,"dialogs",[]);const n=r},25707:(t,e,i)=>{i.d(e,{Z:()=>Q});var s=i(17187),o=i(24613),r=i(7450),n=i(48651),a=i(78133),c=i(79443);let l;try{l=i(52208)}catch(t){}function h(t,e){const i=window.document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return i.setAttribute("width",String(e.width)),i.setAttribute("height",String(e.height)),!l&&t instanceof HTMLImageElement?s.drawImage(t,0,0,e.width,e.height):"string"==typeof t&&(l.Canvg?l.Canvg.fromString(s,t).start():l(i,t)),s.getImageData(0,0,e.width,e.height)}i(85827);var p=i(4061),u=i.n(p);function d(t){const e=[];return function(t,e){!function(t,e){if("FeatureCollection"===t.type)for(const i of t.features)e(i.geometry);else"Feature"===t.type?e(t.geometry):"coordinates"in t&&e(t)}(t,(t=>{if("coordinates"in t)if("Polygon"===t.type||"MultiLineString"===t.type)for(const i of t.coordinates)i.forEach((t=>e(t)));else if("MultiPolygon"===t.type)for(const i of t.coordinates)i.forEach((t=>t.forEach((t=>e(t)))));else if("Point"===t.type)e(t.coordinates);else if("MultiPoint"===t.type||"LineString"===t.type)for(const i of t.coordinates)e(i);return t}))}(t,(t=>e.push(t))),e}function y(t){return"Polygon"===t.geometry.type?u()(t.geometry.coordinates):"Point"===t.geometry.type?t.geometry.coordinates:(e=d(t)).reduce(((t,i)=>[t[0]+i[0]/e.length,t[1]+i[1]/e.length]),[0,0]);var e}function m(t){return t-1}function f(t){const e=t.lngLat,{lng:i,lat:s}=e,{x:o,y:r}=t.point;return{latLng:e,lngLat:[i,s],pixel:{top:r,left:o}}}const g={point:[["color","color"],["fillColor","color"],["opacity","opacity"],["fillOpacity","opacity"],["strokeColor","stroke-color"],["strokeOpacity","stroke-opacity"],["weight","stroke-width"],"radius"],line:[["color","color"],["strokeColor","color"],["opacity","opacity"],["strokeOpacity","opacity"],["weight","width"]],polygon:[["color","color"],["fillColor","color"],["opacity","opacity"],["fillOpacity","opacity"]]},_={Point:"point",LineString:"line",MultiPoint:"point",Polygon:"polygon",MultiLineString:"line",MultiPolygon:"polygon",GeometryCollection:"polygon"},v={point:"Point",line:"LineString",polygon:"Polygon"},L={};for(const t in _){const e=_[t],i=L[e]||[];i.push(t),L[e]=i}function b(t){const e={};for(let i=0;i<t.length;i++)e[t[i]]=1+(e[t[i]]||0);let i="";for(const t in e){const s=i?e[i]:0;e[t]>s&&(i=t)}return i}function w(t,e){const i=L[e];return!!i&&-1!==i.indexOf(t)}function O(t){const e=new o.LngLatBounds,i=Array.isArray(t)?t:[t];for(const t of i){const i=d(t);for(const t of i)e.extend(t)}return e}function P(t){const e=O(t),i=e.getNorthEast(),s=e.getSouthWest();return[s.lng,s.lat,i.lng,i.lat]}function C(t){return{getBounds:()=>P(t),getCenter:()=>function(t){const e=O(t),{lng:i,lat:s}=e.getCenter();return[i,s]}(t)}}function F(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let A=0;function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const k={gt:">",lt:"<",ge:">=",le:"<=",eq:"==",ne:"!=",in:"in",notin:"!in",like:"==",ilike:"=="},S={gt:k.le,lt:k.ge,ge:k.lt,le:k.gt,eq:k.ne,ne:k.eq,in:k.notin,notin:k.in,like:k.ne,ilike:k.ne},I={color:"blue",opacity:1,radius:10},x={polygon:"fill",line:"line",point:"circle"};class M extends class{constructor(t,e){this.options=e,F(this,"layer",void 0),F(this,"map",void 0),F(this,"_layerId",void 0),this.map=t,this._layerId="layer-"+A++}beforeRemove(){if(this.map){const t=this._layerId+"_source";this.map.getSource(t)&&this.map.removeSource(t)}Object.assign(this,{map:void 0})}}{constructor(t,e){super(t,e),this.options=e,E(this,"selected",!1),E(this,"map",void 0),E(this,"featureIdName","id"),E(this,"_types",["polygon","point","line"]),E(this,"_sourceId",void 0),E(this,"_selectionName",void 0),E(this,"_selectedFeatureIds",[]),E(this,"_selectProperties",void 0),E(this,"_filterProperties",void 0),E(this,"_openedPopup",[]),E(this,"$onLayerMouseMove",void 0),E(this,"$onLayerMouseLeave",void 0),this._sourceId=this.options.source?this.options.source:`source-${this._layerId}`,this.options.featureIdName?this.featureIdName=this.options.featureIdName:this.options.source?this.featureIdName="$id":this.featureIdName="fid",this._selectionName=this._layerId+"-highlighted",this.$onLayerMouseLeave=this._onLayerMouseLeave.bind(this),this.$onLayerMouseMove=this._onLayerMouseMove.bind(this),t._onMapClickLayers.push(this)}async addLayer(t){(t=this.options={...this.options,...t||{}}).featureIdName&&(this.featureIdName=t.featureIdName),this.layer=[];const e=this._types=t.type?[t.type]:this._types;if(t.paint){this._beforeLayerLayer(this._sourceId);for(const i of e){const s=v[i];if(s){let o=i;"point"===i&&"icon"===this._detectPaintType(t.paint)&&(o="point");const r=this._getLayerNameFromType(i),n=e.length>1?["==","$type",s]:void 0;if(await this._addGeomLayer(r,o,[n,this._getNativeFilter()]),this.layer.push(r),t.selectedPaint){const t=this._getSelectionLayerNameFromType(i);await this._addGeomLayer(t,o,[n,["in",this.featureIdName,""]],this.options.selectedLayout),this.layer.push(t)}}}await this._onLayerAdd(this._sourceId)}return this._addEventsListeners(),this.layer}propertiesFilter(t,e){this._filterProperties=t,this._updatePropertiesFilter()}removeFilter(){this._filterProperties=void 0,this._updateFilter()}select(t){"function"!=typeof t&&(this._selectProperties=t,this._updateFilter()),this.selected=!0;const{onSelect:e,onLayerSelect:i}=this.options,s=e||i;if(s){const t=[];s({layer:this,features:t,type:"api",...C(t)})}}unselect(){if(this.options.selectable){this._selectProperties=void 0,this._updateFilter(),this.selected=!1;const{onSelect:t,onLayerSelect:e}=this.options,i=t||e;i&&i({layer:this,features:void 0,type:"api",...C([])}),this._removeAllPopup()}}beforeRemove(){const t=this.map;if(t){this.layer&&this.layer.forEach((e=>{t.removeLayer(e)}));const e=t._onMapClickLayers.indexOf(this);-1!==e&&t._onMapClickLayers.splice(e,1)}this._removeAllPopup(),this._removeEventListeners(),this.$onLayerMouseLeave=void 0,this.$onLayerMouseMove=void 0,super.beforeRemove()}setOpacity(t){this.options.opacity=Number(t),this.options.type&&this._updateLayerPaint(this.options.type)}setPaint(t){t&&(this.options.paint=t,this.options.type&&this._updateLayerPaint(this.options.type))}setSelectedPaint(t){t&&(this.options.selectedPaint=t,this.options.type&&this._updateLayerPaint(this.options.type))}updatePaint(t){this.options.paint={...this.options.paint,...t},this.options.type&&this._updateLayerPaint(this.options.type)}updateSelectedPaint(t){this.options.selectedPaint={...this.options.selectedPaint,...t},this.options.type&&this._updateLayerPaint(this.options.type)}_onLayerClick(t){let e;if(t.preventDefault(),this.map){if(this.layer&&(e=this._getFeatureFromPoint(t),e)){const i=this._featureSelect(e,t.lngLat);this.options.onClick&&this.options.onClick({layer:this,selected:i,event:f(t),source:t,...this._createLayerOptions(e)})}return e}}_featureSelect(t,e){const i=this.isFeatureSelected(t);let s=i;if(this.options.selectable){let e;i?this.options&&this.options.unselectOnSecondClick&&(this._unselectFeature(t,{silent:!0}),s=!1):(this.map&&this.map._addUnselectCb((()=>this._unselectFeature(t,{silent:!0}))),e=this._selectFeature(t,{silent:!0}),s=!0),this.options.onSelect&&this.options.onSelect({layer:this,features:e,type:"click",...C(t)})}return s&&this.options.popupOnSelect&&this._openPopup({coordinates:e,feature:t,options:this.options.popupOptions,type:"click",refresh:!0}),this.selected=s,this.selected}_updateWithNativeFilter(t){const e=this._getNativeFilter();return e.length&&t.push(e),t}_getNativeFilter(){return this.options.nativeFilter?this.options.nativeFilter:[]}async _addGeomLayer(t,e,i,s){let o;this.options.paint&&"type"in this.options.paint&&"icon"===this.options.paint.type&&(o="symbol"),void 0===o&&(o=x[e]),s=s||this.options.layout||{};const r={id:t,type:o,source:this._sourceId,filter:i,layout:{visibility:"none",...s},...this._getAdditionalLayerOptions()};this.options.nativeOptions&&Object.assign(r,this.options.nativeOptions),this._addLayer(r)}_addLayer(t){const{filter:e,...i}=t,{minZoom:s,maxZoom:o}=this.options;s&&(i.minzoom=m(s)),o&&(i.maxzoom=m(o));const r=this.map;if(r&&(r.addLayer(i),e)){const t=["all",...e||[]].filter(Boolean);r.setFilter(i.id,t)}}async _beforeLayerLayer(t,e){}async _onLayerAdd(t,e){}async _updateLayerPaint(t){const e=this._getLayerNameFromType(t);if(this.options.paint){const i=[[e,this.options.paint]];if(this.options.selectedPaint){const e=this._getSelectionLayerNameFromType(t);i.push([e,this.options.selectedPaint])}const s=x[t];for(const[e,o]of i){let i,r=null,n=null;if(this.options.nativePaint){r="boolean"==typeof this.options.nativePaint?o:this.options.nativePaint;const e=this.options.opacity;if(void 0!==e&&r){const i=g[t].find((t=>"opacity"===t[0]));i&&r[s+"-"+i[1]];for(const t in r)-1!==t.indexOf("opacity")&&(r[t]=e)}}else n=await this._createPaintForType(o,t,e);if(i=n||r,this.map)if("icon-image"in i){i["icon-allow-overlap"]=!0;for(const t in i)try{this.map.setLayoutProperty(e,t,i[t])}catch(t){}}else for(const t in i)this.map.setPaintProperty(e,t,i[t])}}}_getLayerNameFromType(t){return t+"-"+this._layerId}_getSelectionLayerNameFromType(t){return t+"-"+this._selectionName}async _createPaintForType(t,e,i){if((0,c.GY)(t)){const i={},s={...I,...t||{}};if("icon"===t.type&&t.html)return await this._registerImage(t),{"icon-image":t.html};{const t=s,o=x[e],r=g[e];if(r){let s;for(s in t){const n="polygon"===e&&"strokeColor"===s;if(n&&t.stroke&&(i["fill-outline-color"]=t[s]),!n){const e=r.find((t=>"string"==typeof t?t===s:!!Array.isArray(t)&&t[0]===s));if(e){const r=Array.isArray(e)?e[1]:e,n=this.options.opacity;let a=t[s];void 0!==n&&-1!==r.indexOf("opacity")&&(a=Number(a)*n),i[o+"-"+r]=a}}}}return i[o+"-opacity-transition"]={duration:0},i}}if((0,c.UY)(t)&&t.paint)return this._createPaintForType(t.paint,e)}_getFeatureFilterId(t){const e=t._featureFilterId;return void 0!==e?e:t.properties&&void 0!==t.properties[this.featureIdName]?t.properties[this.featureIdName]:t.id}async _registerImage(t){if((0,c.yb)(t)&&t.html&&this.map&&!this.map.hasImage(t.html)){let s=12,o=12;t.iconSize&&(s=t.iconSize[0],o=t.iconSize[1]);const r=await(e=t.html,i={width:s,height:o},new Promise((t=>{if(l)t(h(e,i));else{const s=new Image;s.crossOrigin="Anonymous",s.src="data:image/svg+xml;base64,"+btoa(e),s.onload=()=>{const e=h(s,i);t(e)}}})));this.map&&this.map.addImage(t.html,r)}var e,i}_selectFeature(t,e){const i=Array.isArray(t)?t:[t];return this.select([[this.featureIdName,"in",i.map((t=>t.properties&&t.properties[this.featureIdName]||t.id))]]),[]}_unselectFeature(t,e){}_getAdditionalLayerOptions(){return{}}_updateFilter(t){this._updatePropertiesFilter()}_updatePropertiesFilter(){const t=this.layer;if(t)for(const e of this._types){const i=v[e];if(i){const s=["==","$type",i],o=this._getLayerNameFromType(e),r=this._getSelectionLayerNameFromType(e),n=this._selectProperties,a=this._filterProperties,c=a&&this._convertToMapboxFilter(a);if(this.map&&-1!==t.indexOf(r)&&this._selectionName){let t=[];n||this._selectedFeatureIds?(n?t=this._convertToMapboxFilter(n)||[]:this._selectedFeatureIds&&(t=[["in",this.featureIdName,...this._selectedFeatureIds]]),c&&c.forEach((e=>t.push(e))),this.map.setFilter(r,["all",s,...t])):(t=["in","$id",""],this.map.setFilter(r,t))}if(this.map&&-1!==t.indexOf(o)){const t=["all",s];this._updateWithNativeFilter(t),n?this._convertToMapboxFilter(n,!0).forEach((e=>t.push(e))):this._selectedFeatureIds&&t.push(["!in",this.featureIdName,...this._selectedFeatureIds]),c&&c.forEach((e=>t.push(e))),this.map.setFilter(o,t)}}}}_convertToMapboxFilter(t){const e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?S:k;return t.map((t=>{if("string"==typeof t)return t;if((0,a.aN)(t)){const[i,s,o]=t,r=e[s];return"in"===s||"notin"===s?[r,i,...o]:[r,i,o]}}))}isFeatureSelected(t){if(this._selectedFeatureIds&&this._selectedFeatureIds.length){const e=this._getFeatureFilterId(t);if(e)return-1!==this._selectedFeatureIds.indexOf(e)}else if(this._selectProperties&&this._selectProperties.length)return(0,a.TE)(t,this._selectProperties);return!1}_removeAllPopup(){for(const t of this._openedPopup)t[1].remove();this._openedPopup.length=0}async _openPopup(t){let{coordinates:e,feature:i,options:s={},type:r,refresh:n}=t;if(n&&e){const t=this._openedPopup.find((t=>t[0].id===i.id));if(t)return void t[1].setLngLat(e)}const a=this.map;if(!a)return;let c;const l=[],h=()=>{c&&this._removePopup(c)},{maxWidth:p,popupContent:u,createPopupContent:d,closeButton:m}=s,f=null!=m?m:!this.options.selectOnHover,g=d?await d({type:r,close:h,onClose:t=>{l.push(t)},...this._createLayerOptions(i)}):u;if(e=e||i&&y(i),g&&e){var _,v;const t="string"==typeof g?function(t){const e=document.createElement("div");return e.innerHTML=t,e}(g):g,s={closeButton:f,closeOnClick:!1};p&&(s.maxWidth="number"==typeof p?p+"px":""),c=new o.Popup(s),c.setLngLat(e).setDOMContent(t).addTo(a),(null===(_=null===(v=this.options.popupOptions)||void 0===v?void 0:v.unselectOnClose)||void 0===_||_)&&c.once("close",(()=>{h()})),this._openedPopup.push([i,c,l])}}_openLabel(t,e){const i=this.map,{labelField:s}=this.options;if(i&&s){const n={closeButton:!1,closeOnClick:!1,closeOnMove:this.options.labelOnHover},a=t.properties&&t.properties[s];if(a&&!this._openedPopup.find((e=>e[0].id===t.id))){var r;const s=new o.Popup(n);e=null!==(r=e)&&void 0!==r?r:y(t),s.setLngLat(e).setText(a).addTo(i),this._openedPopup.push([t,s,[]])}}}_closeLabel(){this._removeAllPopup()}_removeFeaturePopup(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._openedPopup.find((e=>e[0].id===t.id));i&&this._removePopup(i[1],e)}_createLayerOptions(t){return{target:this,feature:t,...C(t)}}_removePopup(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.map){t.remove();const o=this._openedPopup.findIndex((e=>e[1]===t));if(-1!==o){var i,s;const t=null===(i=null===(s=this.options.popupOptions)||void 0===s?void 0:s.unselectOnClose)||void 0===i||i,[r,,n]=this._openedPopup[o];for(const t of n)t(this._createLayerOptions(r));n.length=0,t&&!e&&this._unselectFeature(r),this._openedPopup.splice(o,1)}}}_getFeatureFromPoint(t){const e=this.map;if(e&&this.options.onMouseOver&&this.layer){let i;return this.layer.find((s=>{const o=e.queryRenderedFeatures(t.point,{layers:[s]});return!!o.length&&(i=o[0],!0)})),i}}_onLayerMouseMove(t){const e=this.map;if(e){const{onMouseOver:i,selectOnHover:s,selectable:o,labelOnHover:r}=this.options,n=f(t);if(i||s||r){const e=this._getFeatureFromPoint(t);if(i&&this.layer&&i({event:n,layer:this,source:t,feature:e,...C(e||[])}),e&&(s&&this._featureSelect(e),r)){for(const t of this._openedPopup)this._removePopup(t[1],!0);this._openLabel(e,n.lngLat)}}o&&(e.getCanvas().style.cursor="pointer")}}_onLayerMouseLeave(t){const{onMouseOut:e,labelOnHover:i,selectOnHover:s}=this.options;this.map&&(e&&e({event:f(t),layer:this,source:t}),this.map.getCanvas().style.cursor=""),s&&this.unselect(),i&&this._closeLabel()}_detectPaintType(t){if("type"in t)return t.type;if("function"==typeof t)try{const e=t({type:"Feature",properties:{},geometry:{}});return this._detectPaintType(e)}catch(t){}}_addEventsListeners(){this.layer&&this.options&&this.layer.forEach((t=>{this.$onLayerMouseMove&&this.map&&this.map.on("mousemove",t,this.$onLayerMouseMove),this.$onLayerMouseLeave&&this.map&&this.map.on("mouseleave",t,this.$onLayerMouseLeave)}))}_removeEventListeners(){this.$onLayerMouseMove&&this.map&&this.map.off("mousemove",this.$onLayerMouseMove),this.$onLayerMouseLeave&&this.map&&this.map.off("mouseleave",this.$onLayerMouseLeave)}}function T(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let R=0;function j(t){let{map:e,url:i,headers:s}=t;e.transformRequests.push((t=>{let e=t;if(e=e.replace(/(z=\d+)/,"z={z}"),e=e.replace(/(x=\d+)/,"x={x}"),e=e.replace(/(y=\d+)/,"y={y}"),e===i)return{url:t,headers:s}}))}function N(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let Z=0;class B extends class{constructor(t,e){this.options=e,N(this,"layer",void 0),N(this,"map",void 0),N(this,"_layerId",void 0),this.map=t,this._layerId="layer-"+Z++}beforeRemove(){Object.assign(this,{map:void 0})}setOpacity(t){this.options.opacity=Number(t),this.updateOpacity()}updateOpacity(){const t=this.options.opacity;if(this.map&&this.layer&&void 0!==t)for(const e of this.layer)this.map.setPaintProperty(e,"raster-opacity",t)}}{addLayer(t){if(this.map){t={...this.options,...t||{}},this.options=t;const{minZoom:e,maxZoom:i}=t,s=[],o="string"==typeof t.subdomains?t.subdomains.split(""):t.subdomains;null!=o&&o.length?o.forEach((e=>{s.push(t.url.replace(/{s}/,e))})):s.push(t.url),t.headers&&j({map:this.map,url:t.url,headers:t.headers});const r={type:"raster",tiles:s,tileSize:256};t.attribution&&(r.attribution=t.attribution),this.map.addSource(this._layerId+"_source",r);const n={id:this._layerId,type:"raster",layout:{visibility:"none"},source:this._layerId+"_source"};return e&&(n.minzoom=m(e)),i&&(n.maxzoom=m(i)),t.nativeOptions&&Object.assign(t,t.nativeOptions),this.map.addLayer(n,t.before),this.layer=[this._layerId],this.updateOpacity(),this.layer}}}function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i(26699);class q extends M{constructor(){super(...arguments),z(this,"source",void 0)}async addLayer(t){const e=await super.addLayer(t);return this.map&&t.headers&&j({map:this.map,url:t.url,headers:t.headers}),this._updateLayerPaint(this.options.type||"polygon"),e}_getAdditionalLayerOptions(){return!q.sources.includes(this.options.url)&&this.map&&(this.map.addSource(this.options.url,{type:"vector",tiles:[this.options.url]}),this.source=this.options.url,q.sources.push(this.options.url)),{source:this.options.url,"source-layer":this.options.sourceLayer}}}z(q,"sources",[]);const D={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors',subdomains:"abc",name:"OpenStreetMap"};function $(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function H(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};class i{constructor(){$(this,"_container",void 0)}getDefaultPosition(){return"top-left"}onAdd(){const i=document.createElement("div"),s=t.onAdd();return i.classList.add("maplibregl-ctrl"),e.bar&&(i.classList.add("maplibregl-bar"),i.classList.add("maplibregl-ctrl-group")),e.addClass&&i.classList.add(e.addClass),s&&i.appendChild(s),this._container=i,this._container}onRemove(){if(this._container){const t=this._container.parentNode;t&&t.removeChild(this._container)}return t.onRemove()}remove(){this.onRemove()}}return new i}function G(t){const e=t;return[[e[0],e[1]],[e[2],e[3]]]}function U(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const V={};class J{constructor(){U(this,"options",{}),U(this,"map",void 0),U(this,"emitter",new s.EventEmitter),U(this,"layerAdapters",J.layerAdapters),U(this,"controlAdapters",J.controlAdapters),U(this,"isLoaded",!1),U(this,"_universalEvents",["zoomstart","zoom","zoomend","movestart","move","moveend"]),U(this,"_positionEvents",["mousemove","mouseout","mouseover"]),U(this,"_unselectCb",[]),U(this,"_sourceDataLoading",{}),U(this,"__setLayerOrder",void 0),this.__setLayerOrder=(0,r.D)((t=>this._setLayerOrder(t)))}create(t){return new Promise(((e,i)=>{if(!this.map&&(this.options=t,t.target||t.map)){if(t.map)this.map=t.map;else{if(!t.target)throw new Error("Map target container is not set");const e={style:"string"==typeof t.style?t.style:{version:8,name:"Empty style",sources:{},layers:[],...t.style},container:t.target,attributionControl:!1,bounds:t.bounds,fitBoundsOptions:{...t.fitOptions,...V},...t.mapAdapterOptions||{}};if(void 0!==t.center){const i=t.center;e.center=[i[0],i[1]]}void 0!==t.zoom&&(e.zoom=m(t.zoom)),t.maxZoom&&(e.maxZoom=m(t.maxZoom)),t.minZoom&&(e.minZoom=m(t.minZoom)),this.map=new o.Map(e)}this.map&&this.map._requestManager&&null!==this.map._requestManager._transformRequestFn&&console.warn("The maplibre transformRequest has been overwritten"),this.map.setTransformRequest(((t,e)=>this._transformRequest(t,e)||{url:t})),this.map.setTransformRequest=()=>{throw new Error("You can no longer overwrite 'transformRequest' with 'setTransformRequest' method.\n              This ability is used for correct work of '@nextgis/mapboxgl-map-adapter'.")};const i=()=>{this.map.transformRequests=[],this.map._onMapClickLayers=[],this.map._addUnselectCb=t=>this._addUnselectCb(t),this.isLoaded=!0,this.emitter.emit("create",this),e(this)};this.map.loaded()?i():this.map.once("load",(()=>{i()})),this._addEventsListeners()}}))}destroy(){this.map&&this.map.remove()}getContainer(){return this.map&&this.map.getContainer()}setView(t,e){const i=this.map;if(i)if(Array.isArray(t)){const i=t,s={center:[i[0],i[1]]};e&&(s.zoom=m(e)),this.map.jumpTo(s)}else{const{zoom:e,center:s,maxBounds:o,bounds:r,minZoom:n,maxZoom:a}=t;void 0!==o&&i.setMaxBounds(G(o)),s&&void 0!==e?this.setView(s,e):(void 0!==e&&this.setZoom(e),s&&this.setCenter(s)),void 0!==a&&i.setMaxZoom(m(a)),void 0!==n&&i.setMinZoom(m(n)),r&&this.fitBounds(r)}}setCenter(t){this.map&&this.map.setCenter([t[0],t[1]])}getCenter(){if(this.map){const t=this.map.getCenter();return[t.lng,t.lat]}}setZoom(t){this.map&&this.map.setZoom(m(t))}getZoom(){if(this.map){const t=this.map.getZoom();if(t<1)return;return t?t+1:void 0}}getBounds(){if(this.map){const t=this.map.getBounds().toArray();return[t[0][0],t[0][1],t[1][0],t[1][1]]}}fitBounds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.map){const i={linear:!0,duration:0,...e,...V};e.maxZoom&&(i.maxZoom=m(e.maxZoom)),this.map.fitBounds(G(t),i)}}setRotation(t){}showLayer(t){t&&t.forEach((t=>{this._toggleLayer(t,!0)}))}hideLayer(t){t&&t.forEach((t=>{this._toggleLayer(t,!1)}))}removeLayer(t){const e=this.map;e&&t&&Array.isArray(t)&&t.forEach((t=>{e.removeLayer(t),e.getSource(t)&&e.removeSource(t)}))}setLayerOrder(t,e,i){this.__setLayerOrder(i)}setLayerOpacity(t,e){const i=this.map;i&&t.forEach((t=>{this._onMapLoad().then((()=>{const s=i.getLayer(t);s&&("symbol"===s.type?(i.setPaintProperty(t,"text-opacity",e),i.setPaintProperty(t,"icon-opacity",e)):i.setPaintProperty(t,s.type+"-opacity",e))}))}))}createControl(t,e){return H(t,e)}createButtonControl(t){return function(t){const e=document.createElement("button");if(e.className="maplibregl-ctrl-icon",e.setAttribute("role","button"),t.title&&(e.title=t.title,e.setAttribute("aria-label",t.title)),t.html){t.html instanceof HTMLElement?e.appendChild(t.html):e.innerHTML=t.html;const i=e.firstElementChild;i&&(i.style.width="100%",i.style.height="100%",i.style.lineHeight=(e.offsetHeight||30)+"px")}t.addClass&&t.addClass.split(" ").forEach((t=>e.classList.add(t)));const i=e=>{e.stopPropagation(),t.onClick()};return void 0!==t.onClick&&e.addEventListener("click",i),H({onAdd:()=>e,onRemove(){const s=e.parentNode;s&&s.removeChild(e),void 0!==t.onClick&&e.removeEventListener("click",i)}},{bar:!0,addClass:"maplibregl-ctrl-group"})}(t)}addControl(t,e){if(this.map)return this.map.addControl(t,e),t}removeControl(t){this.map&&this.map.removeControl(t)}onMapClick(t){const e=this.map,i=f(t);if(this.emitter.emit("preclick",i),e){const o=e._onMapClickLayers.sort(((t,e)=>t.options&&t.options.order&&e.options&&e.options.order?e.options.order-t.options.order:1));let r;for(const e of o){let i;var s;if(r||(i=e._onLayerClick(t)),i)e.options.unselectOnSecondClick;else(null===(s=e.options.unselectOnClick)||void 0===s||s)&&e.unselect();!r&&i&&(r=i)}this.emitter.emit("click",i)}}_onMapLoad(t){return new Promise((e=>{const i=()=>{t&&t(),this.map&&e(this.map)};this.isLoaded?i():this.map&&this.emitter.once("create",(()=>{i()}))}))}_setLayerOrder(t){const e=this.map;if(e){const i=[];let s=[];for(const e in t){const o=t[e];o.options.baselayer?i.push(o):s.push(o)}i.forEach((t=>{t.layer&&t.layer.forEach((t=>{e.moveLayer(t)}))})),s=s.sort(((t,e)=>void 0!==t.options.order&&void 0!==e.options.order?t.options.order-e.options.order:0));for(let t=0;t<s.length;t++){const i=s[t];this._getLayerIds(i).forEach((t=>{e.moveLayer(t)}))}}}_getLayerIds(t){let e=[];return t&&(Array.isArray(t.layer)?e=t.layer:t.getDependLayers&&t.getDependLayers().forEach((t=>{const i=t.layer&&t.layer.layer||t;Array.isArray(i)&&i.forEach((t=>{e.push(t)}))}))),e}_toggleLayer(t,e){this._onMapLoad().then((i=>{i.setLayoutProperty(t,"visibility",e?"visible":"none")}))}_onMapSourceData(t){if("source"===t.dataType){const e=t.isSourceLoaded,i=t=>{this.emitter.emit("data-loaded",{target:t})};this._onDataLoad(t,e,i)}}_onMapError(t){if(this._sourceDataLoading[t.sourceId]){const e=t.isSourceLoaded,i=t=>{this.emitter.emit("data-error",{target:t})};this._onDataLoad(t,e,i)}}_onDataLoad(t){let e=arguments.length>2?arguments[2]:void 0;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])Object.keys(this._sourceDataLoading).forEach((t=>{e(t)})),this._sourceDataLoading={};else{const i=this._sourceDataLoading[t.sourceId];if(i&&t.tile){const s=i.indexOf(t.tile);-1!==s&&this._sourceDataLoading[t.sourceId].splice(s,1),i.length||(e(t.sourceId),delete this._sourceDataLoading[t.sourceId])}}}_addUnselectCb(t){for(const t of this._unselectCb)t();this._unselectCb.length=0,this._unselectCb.push(t)}_transformRequest(t,e){const i=this.map&&this.map.transformRequests;if(i)for(const s of i){const i=s(t,e);if(i)return i}}_addEventsListeners(){const t=this.map;if(t){t.on("sourcedataloading",(t=>{this._sourceDataLoading[t.sourceId]=this._sourceDataLoading[t.sourceId]||[],t.tile&&this._sourceDataLoading[t.sourceId].push(t.tile)})),t.on("sourcedata",this._onMapSourceData.bind(this)),t.on("error",this._onMapError.bind(this)),t.on("click",(t=>{this.onMapClick(t)}));for(const e of this._universalEvents)t.on(e,(()=>this.emitter.emit(e,this)));for(const e of this._positionEvents)t.on(e,(t=>this.emitter.emit(e,f(t))))}}}U(J,"layerAdapters",{TILE:B,WMS:class extends B{addLayer(t){Object.assign(this.options,t);const e={bbox:"{bbox-epsg-3857}",format:t.format||"image/png",service:"WMS",version:"1.1.1",request:"GetMap",srs:"EPSG:3857",transparent:"true",width:t.tileSize||"256",height:t.tileSize||"256",layers:t.layers||""},i=Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&");return t.url=t.url+"?"+i,t.nativeOptions&&Object.assign(t,this.options.nativeOptions),super.addLayer(t)}},MVT:q,OSM:class extends B{addLayer(t){return super.addLayer(Object.assign({},D,t))}},GEOJSON:class extends M{constructor(t,e){super(t,e),this.map=t,this.options=e,T(this,"selected",!1),T(this,"source",void 0),T(this,"_features",[]),T(this,"_filteredFeatureIds",void 0),T(this,"_filterFun",void 0),T(this,"_sources",{}),this.source=this._sourceId}async addLayer(t){return await super.addLayer(t)}beforeRemove(){this.map&&this.map.getSource(this._sourceId)&&this.map.removeSource(this._sourceId),super.beforeRemove()}clearLayer(t){let e=[];const i=this.map.getSource(this._sourceId);t&&(e=this._features=this._features.filter((e=>!t(e)))),this._features=e,i.setData({type:"FeatureCollection",features:e})}async addData(t){let e;if(this.options.type&&(e=this.options.type),!e&&t){const i=function(t){let e;return e="FeatureCollection"===t.type?b(t.features.map((t=>t.geometry.type))):"GeometryCollection"===t.type?b(t.geometries.map((t=>t.type))):"Feature"===t.type?t.geometry.type:t.type,e}(t);e=_[i]}if(t&&e){const i=this.filterGeometries(t,e);for(const t of i){const e="_"+R++;t._featureFilterId=e,t.properties&&(t.properties[this.featureIdName]=e),this.options.popup&&this._openPopup({feature:t,type:"api",options:this.options.popupOptions})}this._filterFun&&this._filter(this._filterFun),await this._updateLayerPaint(e),this.map.getSource(this._sourceId).setData({type:"FeatureCollection",features:this._features}),this.options.labelField&&this._updateLabels()}}getLayers(){const t=this._filteredFeatureIds,e=this._filterProperties;return e&&this._updateWithNativeFilter(e),this._getFeatures().map((i=>{let s=!0;if(e&&i.properties)s=(0,a.TE)(i,e);else if(t){const e=this._getFeatureFilterId(i);void 0!==e&&(s=-1!==t.indexOf(e))}return{visible:s,...this._createLayerOptions(i)}}))}filter(t){this._filterFun=t,this._filter(t)}removeFilter(){this._filterFun=void 0,this._filteredFeatureIds=void 0,this._updateFilter()}getSelected(){const t=[],e=this._selectedFeatureIds,i=this._selectProperties,s=this._getFeatures();return e&&e.length?s.forEach((i=>{const s=this._getFeatureFilterId(i);s&&-1!==e.indexOf(s)&&t.push(this._createLayerOptions(i))})):this.source&&i&&s.filter((t=>(0,a.TE)(t,i))).forEach((e=>{t.push(this._createLayerOptions(e))})),t}select(t){if(t)if("function"==typeof t){const e=this._getFeatures().filter((e=>t(this._createLayerOptions(e))));this._selectFeature(e)}else this.selected=!0,this._selectProperties=t,super._updateFilter(),this._fireOnLayerSelectEvent();else this.selected||this._selectFeature(this._getFeatures())}unselect(t){if(this._selectProperties=void 0,t){if("function"==typeof t){const e=this._getFeatures().filter((e=>t(this._createLayerOptions(e))));this._unselectFeature(e),this.selected=!!Array.isArray(this._selectedFeatureIds)}}else this.selected&&(this.selected=!1,this._unselectFeature());this._removeAllPopup()}getExtent(){return this.getBounds()}getBounds(){return P(this._features)}async _beforeLayerLayer(t){let e=this.map.getSource(t);if(!e){const i={type:"geojson",data:{type:"FeatureCollection",features:[]}},s=["cluster","clusterMaxZoom","clusterRadius"];for(const t of s){const e=this.options[t];void 0!==e&&Object.defineProperty(i,t,{value:e})}this.map.addSource(t,i),e=this.map.getSource(t)}this._sources[t]=e}async _onLayerAdd(){this.options.data?await this.addData(this.options.data):this.options.type&&await this._updateLayerPaint(this.options.type)}async _createPaintForType(t,e,i){return"function"==typeof t?await this._getPaintFromCallback(t,e,i):super._createPaintForType(t,e,i)}_selectFeature(t,e){let i=this._selectedFeatureIds||[];this.options&&!this.options.multiselect&&(i=[]);let s=[];return s=Array.isArray(t)?t:[t],s.forEach((t=>{const e=this._getFeatureFilterId(t);void 0!==e&&i.push(e)})),this._selectProperties=void 0,this._selectedFeatureIds=i,this._updateFilter(e),s}_unselectFeature(t,e){if(t){let e=[];if(e=Array.isArray(t)?t:[t],e.length)for(const t of e){const e=this._getFeatureFilterId(t),i=this._selectedFeatureIds;if(i&&void 0!==e){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}this._removeFeaturePopup(t,!0)}}else this._selectedFeatureIds=!1;this._updateFilter(e)}_updateFilter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.map;if(!e)return;var i;if(this._filterProperties||this._selectProperties)return super._updateFilter(t),void(null!==(i=t.silent)&&void 0!==i&&i||this._fireOnLayerSelectEvent());const s=this._selectedFeatureIds;let o=[];const r=[],n=this._filteredFeatureIds;if(n){const t=this._getFeatures();for(const e of t){const t=this._getFeatureFilterId(e);void 0!==t&&-1!==n.indexOf(t)&&(s&&-1!==s.indexOf(t)?o.push(t):r.push(t))}}else s&&(o=s);this.selected=!!s;const a=this.layer;if(a)for(const t of this._types){const i=v[t];if(i){const s=["==","$type",i],c=this._getLayerNameFromType(t),l=this._getSelectionLayerNameFromType(t);if(-1!==a.indexOf(l)&&this._selectionName){const t=["in",this.featureIdName];t.push(...o),e.setFilter(l,["all",s,t])}if(-1!==a.indexOf(c)){const t=["all",s];n?t.push(["in",this.featureIdName,...r]):(t.push(["!in",this.featureIdName,...o]),this._updateWithNativeFilter(t)),e.setFilter(c,t)}}}}_getFeatures(){if(this.source){const t=this.map.getSource(this.source);if(t){const e="string"==typeof t._data?JSON.parse(t._data):t._data;if(e){if("Feature"===e.type)return[e];if("FeatureCollection"===e.type)return e.features}return[]}}return this._features}_filter(t){const e=[];this._getFeatures().forEach((i=>{const s=t(this._createLayerOptions(i)),o=this._getFeatureFilterId(i);s&&o&&e.push(o)})),this._filteredFeatureIds=e,this._updateFilter(),this._updateLabels()}filterGeometries(t,e){let i=[];if("FeatureCollection"===t.type){const s=t.features.filter((t=>w(t.geometry.type,e)));t.features=s,i=s}else if("Feature"===t.type){if(!w(t.geometry.type,e))return[];i.push(t)}else if("GeometryCollection"===t.type){const s=t;s.geometries=s.geometries.filter((t=>w(t.type,e))),i=s.geometries.map((t=>({type:"Feature",geometry:t,properties:{}})))}else _[t.type]&&(i=[{type:"Feature",geometry:t,properties:{}}]);return this._features=this._features.concat(i),i}async _getPaintFromCallback(t,e,i){const s={};s.type=t.type;for(const e of this._features){const o=t(e);if("icon"===o.type)await this._registerImage(o),e.properties&&(e.properties["_icon-image-"+i]=o.html),s["icon-image"]=`{_icon-image-${i}}`;else{let t;for(t in o){const r=o[t];e.properties&&(e.properties[`_paint_${t}_${i}`]=r),s[t]=["get",`_paint_${t}_${i}`]}}}return"icon-image"in s?s:this._createPaintForType(s,e,i)}_fireOnLayerSelectEvent(){if(this.options.onSelect){const t=[];this.getSelected().forEach((e=>{e.feature&&t.push(e.feature)}));const e=t.length?t:void 0;this.options.onSelect({layer:this,features:e,type:"api",...C(e||[])})}}_updateLabels(){this._removeAllPopup();const t=this._filteredFeatureIds||[],e=this._features,{labelField:i,labelOnHover:s}=this.options;if(i&&!s)for(const i of e)(!t.length||(0,n.r)(i._featureFilterId)&&-1!==t.indexOf(i._featureFilterId))&&this._openLabel(i)}}}),U(J,"controlAdapters",{ZOOM:function(t){return new o.NavigationControl({...t,showCompass:!1})},COMPASS:function(t){return new o.NavigationControl({...t,showZoom:!1})},ATTRIBUTION:o.AttributionControl});const Q=J},77869:(t,e,i)=>{i.d(e,{Z:()=>k});var s=i(17187),o=i(61521),r=i(41102),n=i(30077),a=i(3746);class c extends Error{constructor(t){var e,i;super(),i="NetworkError",(e="name")in this?Object.defineProperty(this,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):this.name=i,Object.setPrototypeOf(this,c.prototype),this.message=`Unable to request ${t}.\n    Possibly invalid NGW URL entered or CORS not configured to get request from ${location.origin}`}}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class h extends Error{constructor(t){super(),l(this,"name","NgwError"),l(this,"title",void 0),l(this,"message",void 0),l(this,"detail",void 0),l(this,"exception",void 0),l(this,"status_code",void 0),l(this,"data",void 0),l(this,"guru_meditation",void 0),Object.assign(this,t),Object.setPrototypeOf(this,h.prototype)}}let p;p=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;i.method=i.method||"GET";const r=new XMLHttpRequest;r.open(i.method||"GET",t,!0),"blob"===i.responseType&&(r.responseType=i.responseType);const n=()=>{try{return JSON.parse(r.responseText)}catch(t){return r.responseText}},a=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o=t?s:e;"blob"===i.responseType?o(r.response):r.responseText?o(n()):s({message:""})};r.onload=()=>{-1!==[401,403,404,422,500].indexOf(r.status)&&s(new h(n())),a()},r.onerror=e=>{0===r.status?s(new c(t)):s(e)},r.upload.onprogress=function(t){if(t.lengthComputable){const e=t.loaded/t.total*100;i.onProgress&&i.onProgress(e,t)}};const l=i.headers;if(l)for(const t in l){const e=l[t];"string"==typeof e&&r.setRequestHeader(t,e)}let p;if(void 0!==i.withCredentials&&(r.withCredentials=i.withCredentials),i.file){if(p=new FormData,p.append("file",i.file),i.data)for(const t in i.data)p.append(t,p[t])}else p=i.data?"string"==typeof i.data?i.data:JSON.stringify(i.data):null;o&&o((()=>{r.abort()})),r.send(p)};const u=/\{ *([\w_-]+) *\}/g;function d(t,e){return t.replace(u,((t,i)=>{let s=e[i];if(void 0===s)throw new Error("No value provided for letiable "+t);return"function"==typeof s&&(s=s(e)),s}))}function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class m extends h{constructor(t){super(t),y(this,"name","ResourceNotFoundError"),y(this,"exception","nextgisweb.resource.exception.ResourceNotFound"),Object.setPrototypeOf(this,m.prototype)}}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class g extends h{constructor(t){super(t),f(this,"name","InsufficientPermissionsError"),f(this,"exception","nextgisweb.core.exception.InsufficientPermissions"),Object.setPrototypeOf(this,g.prototype)}}var _=i(65189);const v=[];function L(t){v.push(t)}i(26699),i(13728);var b=i(48651);function w(t){return"[object Object]"===Object.prototype.toString.call(t)}const O=["description"];function P(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e=e?e+"__":"";const i={};for(const[s,o]of Object.entries(t))if(-1===O.indexOf(s))if(w(o))if("owner_user"===s){const t=P(o,s);Object.assign(i,t)}else"parent"===s&&"id"in o&&(i.parent_id=o.id);else(0,b.r)(o)&&(i[e+s]=o);return i}class C{constructor(t){var e,i,s;this.connector=t,e=this,i="cache",s=new a.Z,i in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s}getOne(t,e){const i=new a.Z,s={},r={...e,cache:!1};return"string"==typeof t?s.keyname=t:"number"==typeof t?s.id=t:w(t)&&(void 0!==t.id?s.id=t.id:t.keyname&&(s.keyname=t.keyname)),i.addFull("resource",(()=>"string"==typeof t?this._fetchResourceBy({keyname:t},r):"number"==typeof t?this._fetchResourceById(t,r):w(t)?this._fetchResourceBy(t,r):o.Z.resolve(void 0)),s)}getOneOrFail(t,e){return this.getOne(t,e).then((t=>{if(t)return t;throw new m}))}getId(t,e){return"number"==typeof t?o.Z.resolve(t):"string"==typeof t||w(t)?this.getOne(t,e).then((t=>{if(t)return t.resource.id})):o.Z.resolve(void 0)}getIdOrFail(t,e){return this.getId(t,e).then((t=>{if(void 0===t)throw new Error;return t}))}getMany(t,e){return this._resourceCacheFilter(t).then((i=>{if(!i.length){const i={};return t.keyname?i.keyname=t.keyname:Object.assign(i,P(t)),this.connector.get("resource.search",e,{serialization:"full",...i}).then((t=>{if(t)for(const e of t)this.cache.add("resource.item",o.Z.resolve(e),{id:e.resource.id});return t}))}return i}))}getParent(t,e){return this.getOne(t,e).then((t=>t?this.getOne(t.resource.parent.id,e):o.Z.resolve(void 0)))}getChildrenOf(t,e){return this.getIdOrFail(t).then((t=>this._getChildrenOf(t,e)))}_getChildrenOf(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.connector.get("resource.collection",{cache:!0,...e},{parent:t}).then((t=>{const s=[];for(const r of t)this.cache.add("resource.item",o.Z.resolve(r),{id:r.resource.id}),i.push(r),null!=e&&e.recursive&&r.resource.children&&s.push(this._getChildrenOf(r.resource.id,e,i));return s.length?o.Z.all(s).then((()=>i)):i}))}update(t,e){return this.getId(t).then((t=>{if(void 0!==t)return this.connector.put("resource.item",{data:e},{id:t})}))}delete(t){return this.getId(t).then((t=>{if(void 0!==t)return this.connector.delete("resource.item",null,{id:t}).then((()=>{this._cleanResourceItemCache(t)}))}))}async _cleanResourceItemCache(t){const e=this.cache.all(),i=[];for(const s of e){const e=s.options&&s.options.id;["resource.item","resource"].includes(s.key)&&void 0!==e&&("number"==typeof e?e===t&&i.push(s):await this.getId(e)===t&&i.push(s))}for(const t of i)this.cache.delete(t)}_fetchResourceById(t,e){return this.cache.add("resource.item",(()=>this.connector.get("resource.item",e,{id:t})),{id:t}).catch((t=>{if(!(t instanceof m))throw t}))}_fetchResourceBy(t,e){return this.getMany(t,e).then((t=>t[0]))}_resourceCacheFilter(t){return o.Z.all(this.cache.matchAll("resource.item")).then((e=>(e.filter((e=>{if(e)return t.keyname&&e.resource.keyname?t.keyname===e.resource.keyname:(0,b.r)(t.id)&&(0,b.r)(e.resource.id)?t.id===e.resource.id:(i=t,s=e.resource,(0,_.v)(i,s));var i,s})),[])))}}function F(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let A=0;class E{constructor(t){this.options=t,F(this,"id",A++),F(this,"emitter",new s.EventEmitter),F(this,"user",void 0),F(this,"resources",void 0),F(this,"routeStr","/api/component/pyramid/route"),F(this,"activeRequests",[]);const e=function(t){return v.find((e=>{if(e.options.baseUrl===t.baseUrl){if(!t.auth)return!0;if(e.options.auth)return(0,_.v)(e.options.auth,t.auth)}}))}(t);if(e)return e;this.options.route&&(this.routeStr=this.options.route),this.resources=new C(this),L(this)}static create(t){return new this(t)}setNgw(t){this.logout(),this.options.baseUrl=t,L(this)}connect(){const t=new a.Z,e=this.options.auth;return t.add("route",(()=>new o.Z(((t,i)=>{const s=()=>this.makeQuery(this.routeStr,{},{}).then((e=>{t(e)})).catch((t=>{i(t)}));if(e){const{login:t,password:o}=e;if(t&&o)return this.getUserInfo({login:t,password:o}).then((()=>{s()})).catch((t=>i(t)))}return s()}))),{id:this.id,auth:e,baseUrl:this.options.baseUrl})}login(t){return this.logout(),L(this),this.getUserInfo(t)}logout(){this.abort(),function(t){const e=v.indexOf(t);-1!==e&&v.splice(e,1)}(this),this.options.auth=void 0,this.user=void 0,this.emitter.emit("logout"),this.resources.cache.clean()}getUserInfo(t){if(this.user&&this.user.id)return o.Z.resolve(this.user);t&&(this.options.auth=t);const e={headers:this.getAuthorizationHeaders(t)};return this.makeQuery("/api/component/auth/current_user",{},e).then((t=>(this.user=t,this.emitter.emit("login",t),t))).catch((t=>{throw this.emitter.emit("login:error",t),t}))}getAuthorizationHeaders(t){const e=this.makeClientId(t);if(e)return{Authorization:"Basic "+e}}makeClientId(t){if(t=t||this.options.auth){const{login:e,password:i}=t,s=unescape(encodeURIComponent(`${e}:${i}`));return window.btoa(s)}}abort(){for(const t of this.activeRequests)t.cancel();this.activeRequests=[]}getActiveApiRequests(){return[...this.activeRequests]}apiRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{method:s,headers:n,withCredentials:c,responseType:l}=i,h=(0,r.d)(e),p=()=>function(t){const e=t.params;return new o.Z(((i,s)=>{t.connector.connect().then((o=>{let r=o&&o[t.name];if(r){r=[...r];let o=r.shift();if(r.length){const t={};for(let i=0;i<r.length;i++){const s=r[i];if(t[i]="{"+s+"}",void 0===e[s])throw new Error("`"+s+"` url api argument is not specified")}o&&(o=d(o,t))}if(e){const t=[],i=e.paramList;Array.isArray(i)&&(delete e.paramList,i.forEach((e=>{t.push(`${e[0]}=${e[1]}`)})));for(const i in e)-1===r.indexOf(i)&&t.push(`${i}=${e[i]}`);t.length&&(o=o+"?"+t.join("&"))}o?i(t.connector.makeQuery(o,e,t.requestOptions)):s(new Error("request url is not set"))}else i(void 0)})).catch((t=>{s(t)}))}))}({name:t,params:h,requestOptions:i,connector:this});return i.cache&&"GET"===s?(new a.Z).add(t,p,{params:h,...(0,r.d)({headers:n,withCredentials:c,responseType:l,baseUrl:this.options.baseUrl,auth:this.options.auth})}):p()}post(t,e,i){return(e=e||{}).method="POST",this.apiRequest(t,i,e)}get(t,e,i){return(e=e||{}).method="GET",this.apiRequest(t,i,e)}patch(t,e,i){return(e=e||{}).method="PATCH",this.apiRequest(t,i,e)}put(t,e,i){return(e=e||{}).method="PUT",this.apiRequest(t,i,e)}delete(t,e,i){return(e=e||{}).method="DELETE",this.apiRequest(t,i,e)}makeQuery(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t=(this.options.baseUrl?this.options.baseUrl:"")+t)return e&&(t=d(t,e)),t=(0,n.n)(t),this._loadData(encodeURI(t),i);throw new Error("Empty `url` not allowed")}getResource(t,e){return this.resources.getOne(t,e)}getResourceOrFail(t,e){return this.resources.getOneOrFail(t,e)}getResourceBy(t){return this.resources.getOne(t)}getResourceByKeyname(t){return this.resources.getOne(t)}getResourceById(t){return this.resources.getOne(t)}getResourceId(t,e){return this.resources.getId(t,e)}getResourceIdOrFail(t,e){return this.resources.getIdOrFail(t,e)}getResourcesBy(t,e){return this.resources.getMany(t,e)}getResourceParent(t,e){return this.resources.getParent(t,e)}getResourceChildren(t,e){return this.resources.getChildrenOf(t,e)}updateResource(t,e){return this.resources.update(t,e)}deleteResource(t){return this.resources.delete(t)}_loadData(t,e){e.responseType=e.responseType||"json";const i=new o.Z(((i,s,o)=>{this.user&&((e=e||{}).headers={...this.getAuthorizationHeaders(),...e.headers}),p(t,i,e,s,o)})).then((t=>(this._cleanActiveRequests(i),t))).catch((t=>{if(this._cleanActiveRequests(i),t instanceof o.Z.CancelError);else{const e=this._handleHttpError(t);if(e)throw e}}));return e.signal&&"function"==typeof e.signal.addEventListener&&e.signal.addEventListener("abort",(()=>{i.cancel()})),this.activeRequests.push(i),i}_cleanActiveRequests(t){const e=this.activeRequests.indexOf(t);-1!==e&&this.activeRequests.splice(e,1)}_handleHttpError(t){if(t&&t instanceof h){if("nextgisweb.resource.exception.ResourceNotFound"===t.exception)throw new m(t);if("nextgisweb.core.exception.InsufficientPermissions"===t.exception)throw new g(t)}return t}}F(E,"errors",{NgwError:h,ResourceNotFoundError:m});const k=E},79443:(t,e,i)=>{function s(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"function"==typeof t}function r(t){return"icon"===t.type||"html"in t}i.d(e,{yb:()=>r,GY:()=>s,UY:()=>o,Yx:()=>p});const n={get:function(t,e){const i=e[0];return t.properties&&t.properties[i]},match:function(t,e){const[i,...s]=e;let o=i;Array.isArray(i)&&(o=a(t,i));const r=s.splice(-1,s.length%2)[0];for(let t=0;t<s.length-1;t+=2)if(s[t]===o)return s[t+1];return r}};function a(t,e){const[i,...s]=e,o=n[i];if(o)return o(t,s)}function c(t){return e=>a(e,t)}const l=["iconSize","iconAnchor"];var h=i(78133);function p(t,e,i){if(!t)throw new Error("paint is empty");let s={...e};if(o(t)){const s=s=>{const o=p(t(s),e,i);return o.type=t.type,o};return s.type=t.type,s}if(function(t){return!!Array.isArray(t)}(t))return s=>p(function(t){let e={};const i=[];for(const s of t)s&&(Array.isArray(s)?i.push(s):e=s);return t=>{const s=i.find((e=>(0,h.TE)(t,e[0])));return s?{...e,...s[1]}:e}}(t)(s),e,i);if("get-paint"===t.type){const o=function(t,e){if("function"==typeof t.from)return t.from(t.options);if("string"==typeof t.from&&e){const i=e[t.from];if(i)return i(t.options)}}(t,i);o&&(s=p(o,e,i))}else{if("icon"===t.type)return t;{const o=function(t){let e=!1;const i={};for(const o in t)if(-1===l.indexOf(o)){const r=o,n=t[r];s=n,Array.isArray(s)&&(e=!0,i[r]=c(n))}var s;if(e)return e=>{const s={};for(const t in i)s[t]=i[t](e);return{...t,...s}}}(t);if(o){const s=t=>p(o(t),e,i);return s.paint=t,s}s={...s,...t},s.fill=void 0===s.fill||s.fill,s.stroke=void 0!==s.stroke?s.stroke:!s.fill||!(!s.strokeColor&&!s.strokeOpacity)}}return o(s)||("color"in s&&(s.strokeColor||(s.strokeColor=s.color),s.fillColor||(s.fillColor=s.color)),"opacity"in s&&(void 0===s.strokeOpacity&&(s.strokeOpacity=s.opacity),void 0===s.fillOpacity&&(s.fillOpacity=s.opacity))),s}},78133:(t,e,i)=>{function s(t,e,i){if((e=String(e))===(t=String(t)))return!0;if(i&&e.toUpperCase()===t.toUpperCase())return!0;const s=`^${o=e,o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}$`.replace(/%/g,".*").replace("_",".");var o;return null!==new RegExp(s,i?"i":"").exec(t)}i.d(e,{TE:()=>n,aN:()=>r,Ml:()=>a});const o={gt:(t,e)=>t>e,lt:(t,e)=>t<e,ge:(t,e)=>t>=e,le:(t,e)=>t<=e,eq:(t,e)=>t===e,ne:(t,e)=>t!==e,in:(t,e)=>-1!==e.indexOf(t),notin:(t,e)=>-1===e.indexOf(t),like:(t,e)=>s(t,e),ilike:(t,e)=>s(t,e,!0)};function r(t){const e=t;return 3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]}function n(t,e){const i={...t.properties};return!!i&&(i.$id=t.id,a(i,e))}function a(t,e){const i="string"==typeof e[0]?e[0]:"all",s=e=>{if(r(e)){const[i,s,r]=e,n=o[s];if(n){if(("like"===s||"ilike"===s)&&"string"==typeof i){let e="";const s=i.replace(/^%?(\w+)%?$/,((s,o)=>(e=t[o],i.replace(o,r))));return n(e,s)}return n(t[i],r)}return!1}return a(t,e)},n=e.filter((t=>Array.isArray(t)));return"any"===i?n.some(s):n.every(s)}},9578:(t,e,i)=>{function s(t,e,i){i.forEach((i=>{const s=Object.getOwnPropertyDescriptor(e.prototype,i);s&&Object.defineProperty(t.prototype,i,s)}))}i.d(e,{WL:()=>d});const o={tms:"TILE"};function r(t){const e=("https:"===location.protocol?"https":"http")+"://";let i=t.url.replace(/^(https?|ftp):\/\//,e);return t.y_origin_top||(i=i.replace("{y}","{-y}")),{url:i,name:t.name,attribution:t.copyright_text,maxZoom:t.z_max,minZoom:t.z_min}}var n=i(30077);function a(t){return new Promise(((e,i)=>{const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(4===s.readyState&&200===s.status&&s.responseText)try{e(JSON.parse(s.responseText))}catch(t){i(t)}},s.open("GET",(0,n.n)(t),!0),s.send()}))}function c(t){const e=[];return[t=t.replace(/{switch:(.*?)}/,((t,i)=>("string"==typeof i&&i.split(",").forEach((t=>e.push(t))),"{s}"))),e]}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const h="https://qms.nextgis.com";function p(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e||(e=h);class n{constructor(t,e){l(this,"qms",void 0),l(this,"options",void 0),l(this,"map",void 0),this.map=t;const s={...i,...e};this.options=s,this.options.baselayer=!0,s.qms&&(this.qms=s.qms)}async addLayer(i){if(!this.qms&&i.qmsId)try{this.qms=await a(e+"/api/v1/geoservices/"+i.qmsId)}catch(t){console.error(t)}const l=this.qms;if(l){const e=o[l.type||"tms"],a=t.mapAdapter.layerAdapters[e];if(a&&(s(n,a,["showLayer","hideLayer"]),"TILE"===e)){if(i={order:0,maxZoom:t.options.maxZoom,minZoom:t.options.minZoom,...this.options,...r(l)},l.origin_url){const[t,e]=c(l.origin_url);e.length&&(i.subdomains=e,i.url=t)}return this.options=i,new a(this.map,i).addLayer(i)}}}}return n}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class d{constructor(t){u(this,"options",{url:"https://qms.nextgis.com"}),u(this,"url",void 0),this.options={...this.options,...t},this.url=this.options.url}getLayerAdapters(){return Promise.resolve([{name:"QMS",createAdapter:t=>Promise.resolve(this._createAdapter(t))}])}_createAdapter(t){return p(t,this.url)}}u(d,"utils",{createQmsAdapter:p})},55502:(t,e,i)=>{i.d(e,{Z:()=>s});const s=class{constructor(){var t,e;e={},(t="_params")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e}get(t){return this.params()[t]}params(){const t=window.location.href.replace(/#$/,""),e={};return t.replace(/[?&]+(\w+)([^&]*)/gi,(function(t,i){return e[i]=!0,""})),t.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,i,s){return e[i]=decodeURIComponent(s),""})),this._params=e,e}set(t,e){if(e){let i;const s=encodeURIComponent(e);i=this.get(t)?location.search.replace(new RegExp("([?|&]"+t+"=)(.+?)(&|$)"),"$1"+s+"$3"):location.search.length?location.search+"&"+t+"="+s:"?"+t+"="+s;const o={};o[t]=e,this._params[t]=e;const r={state:{url:i,params:o},url:i};return this._pushState(r),r}return this.remove(t)}remove(t){const e=location.search;let i,s,o=e.split("?")[0];const r=-1!==e.indexOf("?")?e.split("?")[1]:"";if(""!==r){s=r.split("&");for(let e=s.length-1;e>=0;e-=1)i=s[e].split("=")[0],i===t&&s.splice(e,1);o=o+"?"+s.join("&")}delete this._params[t];const n={state:{url:o,type:"remove"},url:o};return this._pushState(n),n}_pushState(t){history&&history.replaceState(null,document.title,t.url)}}},25952:(t,e,i)=>{function s(t){return t.filter(((t,e,i)=>i.indexOf(t)==e))}i.d(e,{u:()=>s})},7450:(t,e,i)=>{function s(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;function s(){for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];s.clear(),e=setTimeout((()=>{e=null,t.apply(this,r)}),i)}return s.clear=function(){e&&(clearTimeout(e),e=null)},s}i.d(e,{D:()=>s})},48651:(t,e,i)=>{function s(t){return null!=t}function o(t){return"string"==typeof t?!!t:s(t)}i.d(e,{f:()=>o,r:()=>s})},43812:(t,e,i)=>{i.d(e,{z:()=>s});class s{constructor(t){var e,i;this.emitter=t,i={},(e="_eventsStatus")in this?Object.defineProperty(this,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[e]=i}setEventStatus(t,e){this._eventsStatus[t]=e}onLoad(t){const e=(Array.isArray(t)?t:[t]).map((t=>new Promise((e=>{if(this.getEventStatus(t))e(this);else{const i=t;this.emitter.once(i,(()=>{this.setEventStatus(t,!0),e(this)}))}}))));return Promise.all(e).then((()=>this))}getEventStatus(t){const e=t,i=this._eventsStatus[e];return void 0!==i&&!!i}}},65189:(t,e,i)=>{function s(t,e,i,s){if(t instanceof Array)return e instanceof Array&&e.sort().join("")===t.sort().join("");if(t instanceof Date)return e instanceof Date&&""+t==""+e;if(t instanceof Function){if(!(e instanceof Function))return!1}else if(t instanceof Object)return e instanceof Object&&(t===i?e===s:o(t,e));return t===e}function o(t,e){const i=Object.keys(t).sort(),o=Object.keys(e).sort();if(i.length!==o.length)return!1;if(i.join("")!==o.join(""))return!1;for(let r=0;r<i.length;r++)if(!s(t[i[r]],e[o[r]],t,e))return!1;return!0}i.d(e,{v:()=>o})},41102:(t,e,i)=>{function s(t){const e={};return Object.keys(t).forEach((i=>{t[i]instanceof Array||t[i]!==Object(t[i])?void 0!==t[i]&&(e[i]=t[i]):e[i]=s(t[i])})),e}i.d(e,{d:()=>s})},99223:(t,e,i)=>{function s(t){const e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),e.join(".")}i.d(e,{_:()=>s})},30077:(t,e,i)=>{function s(t){return t.replace(/([^:]\/)\/+/g,"$1")}i.d(e,{n:()=>s})},13862:(t,e,i)=>{i.d(e,{y9:()=>I}),i(26699);var s=i(48651),o=i(79443),r=i(78133);function n(t){const e={};for(let i=0;i<t.length;i++)e[t[i]]=1+(e[t[i]]||0);let i;for(const t in e){const s=void 0!==i?e[i]:0;e[t]>(s||0)&&(i=t)}return i}const a={polygon:"path",line:"path",point:"circle"},c={Point:"point",LineString:"line",MultiPoint:"point",Polygon:"polygon",MultiLineString:"line",MultiPolygon:"polygon"};var l=i(17187);function h(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=t;const o=e,r=Array.isArray(o);let n=r&&[]||{};return r&&Array.isArray(o)?i?(s=s||[],n=n.concat(s),o.forEach(((t,e)=>{void 0===n[e]?n[e]=t:"object"==typeof t?n[e]=h(s[e],t,i):-1===s.indexOf(t)&&n.push(t)}))):n=o:(s&&"object"==typeof s&&Object.keys(s).forEach((function(t){n[t]=s[t]})),Object.keys(o).forEach((function(t){"object"==typeof o[t]&&o[t]&&"object"==typeof s[t]&&"object"==typeof o[t]?n[t]=h(s[t],o[t],i):n[t]=o[t]}))),n}function p(t){const e=[t[0],t[1]];return[e,[t[2],t[1]],[t[2],t[3]],[t[0],t[3]],e]}var u=i(61521);function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class y{constructor(){d(this,"backspace",8),d(this,"tab",9),d(this,"enter",13),d(this,"shift",16),d(this,"ctrl",17),d(this,"alt",18),d(this,"pause/break",19),d(this,"caps_lock",20),d(this,"escape",27),d(this,"page_up",33),d(this,"page_down",34),d(this,"end",35),d(this,"home",36),d(this,"left_arrow",37),d(this,"up_arrow",38),d(this,"right_arrow",39),d(this,"down_arrow",40),d(this,"insert",45),d(this,"delete",46),d(this,"left_window_key",91),d(this,"right_window_key",92),d(this,"select_key",93),d(this,"numpad_0",96),d(this,"numpad_1",97),d(this,"numpad_2",98),d(this,"numpad_3",99),d(this,"numpad_4",100),d(this,"numpad_5",101),d(this,"numpad_6",102),d(this,"numpad_7",103),d(this,"numpad_8",104),d(this,"numpad_9",105),d(this,"multiply",106),d(this,"add",107),d(this,"subtract",109),d(this,"decimal_point",110),d(this,"divide",111),d(this,"f1",112),d(this,"f2",113),d(this,"f3",114),d(this,"f4",115),d(this,"f5",116),d(this,"f6",117),d(this,"f7",118),d(this,"f8",119),d(this,"f9",120),d(this,"f10",121),d(this,"f11",122),d(this,"f12",123),d(this,"num_lock",144),d(this,"scroll_lock",145),d(this,"semi-colon",186),d(this,"equal_sign",187),d(this,",",188),d(this,"-",189),d(this,".",190),d(this,"/",191),d(this,"`",192),d(this,"[",219),d(this,"\\",220),d(this,"]",221),d(this,"'",222)}}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class g{constructor(t,e){this.webMap=t,f(this,"name",void 0),f(this,"event",void 0),f(this,"value",void 0),e&&(e.value&&this.setValue(e.value),e.name&&(this.name=e.name),e.event&&(this.event=e.event))}getValue(){return this.value}setValue(t){this.value=t}}function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class v extends g{constructor(){super(...arguments),_(this,"name","center"),_(this,"event","moveend")}getValue(){return this.webMap.getCenter()}setValue(t){this.webMap.setCenter(t)}toString(t){const e=t.map((t=>t.toFixed(5)));return e[0]+"_"+e[1]}parse(t){return t.split("_").map(Number)}}function L(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class b extends g{constructor(){super(...arguments),L(this,"name","zoom"),L(this,"event","zoomend")}getValue(){const t=this.webMap.getZoom();return void 0!==t?Math.round(t):void 0}setValue(t){this.webMap.setZoom(t)}toString(t){return String(t)}parse(t){return Number(t)}}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let O=0;const P={minZoom:0,maxZoom:20,paint:{color:"#0000ff",opacity:.4,strokeOpacity:1,stroke:!0,radius:8,weight:1},selectedPaint:{color:"#00008b",opacity:.4,strokeOpacity:1,stroke:!0,radius:12,weight:1},create:!0};class C{constructor(t){w(this,"options",P),w(this,"emitter",new l.EventEmitter),w(this,"keys",C.keys),w(this,"mapAdapter",void 0),w(this,"runtimeParams",[]),w(this,"getPaintFunctions",C.getPaintFunctions),w(this,"mapState",[v,b]),w(this,"id",O++),w(this,"_initMapState",{}),w(this,"_starterKits",void 0),w(this,"_mapState",[]),w(this,"_extent",void 0),w(this,"_eventsStatus",{}),w(this,"_coordFromMapClickPromise",void 0),w(this,"_mapEvents",{}),this.mapAdapter=t.mapAdapter,this._starterKits=t.starterKits||[],t&&(this.options=h(P||{},t)),this.options.runtimeParams&&(this.runtimeParams=this.options.runtimeParams),this._addEventsListeners(),this.options.tileJson&&this._setTileJsonOptions(this.options.tileJson),this.options.create&&this.create()}getId(){return this.id}async create(){return this.getEventStatus("create")||(await this._setInitMapState(this.mapState),await this._setupMap(),this._emitStatusEvent("create",this)),this}setRuntimeParams(t){this.runtimeParams.push(t)}destroy(){this._removeEventListeners(),function(t){for(const e in t)delete t[e]}(this._emitStatusEvent),this.mapAdapter.destroy&&this.mapAdapter.destroy()}getState(){const t={};return this._mapState.forEach((e=>{t[e.name]=e.getValue()})),t}getRuntimeParams(){const t={};return this._mapState.forEach((e=>{for(const i of this.runtimeParams){const s=i.get(e.name);if(void 0!==s){t[e.name]=e.parse(s);break}}})),t}getContainer(){if(this.mapAdapter.getContainer)return this.mapAdapter.getContainer();if(this.options.target){if(this.options.target instanceof HTMLElement)return this.options.target;if("string"==typeof this.options.target){const t=document.getElementById(this.options.target);if(t)return t}}}setCursor(t){this.mapAdapter.setCursor&&this.mapAdapter.setCursor(t)}getCursor(){if(this.mapAdapter.getCursor)return this.mapAdapter.getCursor();const t=this.getContainer();return t?t.style.cursor:void 0}setCenter(t){return this.mapAdapter.setCenter(t),this}getCenter(){return this.mapAdapter.getCenter()}getBounds(){if(this.mapAdapter.getBounds)return this.mapAdapter.getBounds()}getBoundsPolygon(){const t=this.getBounds();if(t)return{type:"Feature",properties:{},geometry:(e=t,{type:"Polygon",coordinates:[p(e)]})};var e}setZoom(t){return this.mapAdapter.setZoom(t),this}getZoom(){const t=this.mapAdapter.getZoom();if("number"==typeof t)return t}zoomIn(){if(this.mapAdapter.zoomIn)this.mapAdapter.zoomIn();else{const t=this.getZoom();if(void 0!==t){const e=t+1;this.setZoom(e)}}}zoomOut(){if(this.mapAdapter.zoomOut)this.mapAdapter.zoomOut();else{const t=this.getZoom();if(void 0!==t){const e=t-1;this.setZoom(e)}}}setView(t,e){if(Array.isArray(t)){const i=t;this.mapAdapter.setView&&i&&(0,s.r)(e)?this.mapAdapter.setView(i,e):(i&&this.mapAdapter.setCenter(i),(0,s.r)(e)&&this.mapAdapter.setZoom(e))}else{const e=t;this.mapAdapter.setView&&this.mapAdapter.setView(e)}}fitBounds(t,e){return t.every((t=>(0,s.r)(t)))&&(t[1]<-85.06&&(t[1]=-85.06),t[3]>85.06&&(t[3]=85.06),this.mapAdapter.fitBounds(t,e)),this}getEventStatus(t){const e=t,i=this._eventsStatus[e];return null!=i&&i}onLoad(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"create";return new Promise((e=>{this.getEventStatus(t)?e(this):this.emitter.once(t,(()=>{e(this)}))}))}onMapLoad(t){return new Promise((e=>{var i;const s=()=>{const i=this.mapAdapter;t&&t(i),i&&e(i)},o=null===(i=this.mapAdapter.isLoaded)||void 0===i||i;this.mapAdapter.map&&o?s():this.mapAdapter.emitter.once("create",(()=>{s()}))}))}getLayerAdapters(){return this.mapAdapter.layerAdapters}getLayerAdapter(t){return this.mapAdapter.layerAdapters[t]}locate(t,e){return this.mapAdapter&&this.mapAdapter.locate?this.mapAdapter.locate(t,e):{stop:()=>({})}}stopGetCoordFromMapClick(){this._coordFromMapClickPromise&&this._coordFromMapClickPromise.cancel()}getCoordFromMapClick(){return this._coordFromMapClickPromise?this.getCoordFromMapClick():(this._coordFromMapClickPromise=new u.Z(((t,e,i)=>{const s=this.getCursor()||"grab";this._removeEventListeners({include:["click"]}),this.setCursor("crosshair");const o=()=>{this.setCursor(s),this._addEventsListeners({include:["click"]}),this.mapAdapter.emitter.off("click",r),this._coordFromMapClickPromise=void 0},r=e=>{o(),function(t){if(!t.lngLat&&t.latLng){const e=t.latLng.lat,i=t.latLng.lng;t.lngLat=[i,e]}}(e),t(e.lngLat)};this.mapAdapter.emitter.once("click",r),i(o)})),this._coordFromMapClickPromise)}_emitStatusEvent(t,e){const i=t;this._eventsStatus[i]=!0,this.emitter.emit(i,e)}async _addLayerProviders(){}async _onLoadSync(){}async _setupMap(){if(!this.mapAdapter)throw new Error("WebMap `mapAdapter` option is not set");return await this.mapAdapter.create(this.options),this._zoomToInitialExtent(),await this._addLayerProviders(),await this._onLoadSync(),this._emitStatusEvent("build-map",this.mapAdapter),this}_setTileJsonOptions(t){t.center&&(this.options.center=t.center),t.bounds&&(this.options.bounds=t.bounds),(0,s.r)(t.maxzoom)&&(this.options.maxZoom=t.maxzoom,this.options.zoom=t.maxzoom),(0,s.r)(t.minzoom)&&(this.options.minZoom=t.minzoom,this.options.zoom=t.minzoom),(0,s.r)(t.maxzoom)&&(0,s.r)(t.minzoom)&&(this.options.zoom=(t.maxzoom+t.minzoom)/2)}_zoomToInitialExtent(){const{center:t,zoom:e,bounds:i}=this.options;this._extent?this.fitBounds(this._extent):t&&e?this.setView(t,e):i&&this.fitBounds(i)}_setInitMapState(t){for(const e of t){const t=new e(this);this._mapState.push(t);for(const e of this.runtimeParams){const i=e.get(t.name);if(void 0!==i){const e=t.parse(i);this._initMapState[t.name]=e,Object.defineProperty(this.options,t.name,{value:e,configurable:!0,enumerable:!0});break}}}}_addEventsListeners(t){let e=["preclick","click","zoomstart","zoom","zoomend","movestart","move","moveend","mousemove","mouseout","mouseover"];t&&t.include&&(e=e.filter((e=>t.include.includes(e)))),e.forEach((t=>{this._mapEvents[t]=e=>{if(this.runtimeParams.length){const e=this._mapState.find((e=>e.event===t));if(e){const t=e.toString(e.getValue());this.runtimeParams.forEach((i=>{i.set(e.name,t)}))}}this._eventsStatus&&this.emitter.emit(t,e)};const e=this._mapEvents[t];e&&this.mapAdapter.emitter.on(t,e)}))}_removeEventListeners(t){let e=Object.entries(this._mapEvents);t&&t.include&&(e=e.filter((e=>t.include.includes(e[0])))),e.forEach((t=>{let[e,i]=t;i&&this.mapAdapter.emitter.removeListener(e,i)}))}}function F(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}w(C,"keys",new class{constructor(){m(this,"keyCodeAlias",new y),m(this,"keys",{}),m(this,"_windowOnFocus",void 0),m(this,"_keysPressed",void 0),m(this,"_keysReleased",void 0),this._windowOnFocus=this.windowOnFocus.bind(this),this._keysPressed=this.keysPressed.bind(this),this._keysReleased=this.keysReleased.bind(this),this.addKeyboardEventsListener()}pressed(t){const e=this.keyCodeAlias[t];return!!e&&this.keys[e]}addKeyboardEventsListener(){"undefined"!=typeof window&&(window.addEventListener("focus",this._windowOnFocus,!1),window.addEventListener("keydown",this._keysPressed,!1),window.addEventListener("keyup",this._keysReleased,!1))}removeKeyboardEventsListener(){"undefined"!=typeof window&&(window.removeEventListener("focus",this._windowOnFocus,!1),window.removeEventListener("keydown",this._keysPressed,!1),window.removeEventListener("keyup",this._keysReleased,!1))}keysPressed(t){t.stopPropagation(),this.keys[t.keyCode]||(this.keys[t.keyCode]=!0)}keysReleased(t){t.stopPropagation(),this.keys[t.keyCode]=!1}windowOnFocus(){this.keys={}}}),w(C,"getPaintFunctions",void 0);class A extends C{constructor(t){super(t),F(this,"_layersIdCounter",1),F(this,"_layersOrderCounter",1),F(this,"_baselayers",[]),F(this,"_layers",{}),F(this,"_selectedLayers",[]);const e=this.options.tileJson;e&&this.emitter.once("build-map",(()=>this.addTileJsonLayer(e)))}async fitLayer(t,e){const i=this.getLayer(t),s=i&&(i.getBounds||i.getExtent);if(s){const t=await s.call(i);t&&this.fitBounds(t,e)}}isBaseLayer(t){const e=this.getLayer(t);if(e&&e.id)return-1!==this._baselayers.indexOf(e.id)}getBaseLayers(){const t=[];return this._baselayers.forEach((e=>{const i=this._layers[e];i&&t.push(i)})),t}getBaseLayersIds(){return this._baselayers}getLayer(t){return"string"==typeof t?this._layers[t]:t}getLayerId(t){const e=this.getLayer(t);if(e){if(e.id)return null==e?void 0:e.id;if(e&&e.options)return e.options.id}throw new Error("No id for layer")}getLayers(){return Object.keys(this._layers)}allLayers(){return this._layers}orderedLayers(){return Object.values(this._layers).sort(((t,e)=>t.order&&e.order?t.order-e.order:0))}findLayer(t){for(const e in this._layers){const i=this._layers[e];if(t(i))return i}}isLayerVisible(t){const e=this.getLayer(t);return!(!e||void 0===e.options.visibility)&&e.options.visibility}async addBaseLayer(t,e){return await this.addLayer(t,{...e,baselayer:!0},void 0)}async addLayer(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const r=this._layersIdCounter++,n=(0,s.r)(o)?o:void 0!==i.order?i.order:this.reserveOrder();let a;"string"==typeof t?a=this.getLayerAdapter(t):"function"==typeof t?a=t:"then"in t&&(a=await t);const c=i;this._updateGeoJsonOptions(c),i={id:String(r),order:n,...i};const l=null===(e=i.visibility)||void 0===e||e;if(i.visibility=!1,i.baselayer&&(i.order=0),this.options.onBeforeAddLayer){const t=this.options.onBeforeAddLayer({options:i,adapter:a});t&&(t.options&&(i=t.options),t.adapter&&(a=t.adapter))}if(void 0!==a){var h;const t=new a(this.mapAdapter.map,i);let e;t.options={...i,...t.options},t.options.baselayer&&(i.baselayer=!0,i.order=0,t.options.order=0),t.options.id&&(e=String(t.options.id),this._layers[e]=t),this._emitLayerEvent("layer:preadd",e||"",t),await this.onMapLoad(),t.map=this.mapAdapter.map;const s=await t.addLayer(t.options);if(t.layer=s,t.id=t.options.id||String(r),t.options.id=t.id,i.baselayer&&(t.options.order=0),t.order=null!==(h=t.options.order)&&void 0!==h?h:n,e&&delete this._layers[e],e=String(t.id),this._layers[e])throw Error(`layer with id '${e}' already exist`);e&&(this._layers[e]=t,c.filter&&this.filterLayer(t,c.filter),i.baselayer&&this._baselayers.push(e),l&&await this.showLayer(e));const o=i.opacity;void 0!==o&&o<=1&&this.setLayerOpacity(t,o);const p=s&&(t.getBounds||t.getExtent);if(i.fit&&p){const e=await p.call(t);e&&await this.fitBounds(e)}return i.onAdded&&i.onAdded(t),this._emitLayerEvent("layer:add",e,t),t}return Promise.reject("No adapter")}async addLayerFromAsyncAdapter(t,e,i){const s=i||void 0!==e.order?e.order:this.reserveOrder(),o=t(),r=await o;return r?this.addLayer(r,e,s):Promise.reject("No adapter")}removeLayers(t){for(const e in this._layers){let i=!0;t&&(i=t(e,this._layers[e])),i&&(this.removeLayer(e),delete this._layers[e])}}reserveOrder(){return this._layersOrderCounter++}removeOverlays(){this.removeLayers(((t,e)=>!(e&&e.options&&e.options.baselayer)))}removeLayer(t){const e=this.getLayer(t),i=e&&this.getLayerId(e);if(e&&i){if(this.emitter.emit("layer:preremove",e),e.beforeRemove&&e.beforeRemove(),e.removeLayer?e.removeLayer():this.mapAdapter.removeLayer(e.layer),e.options&&e.options.baselayer){const t=this._baselayers.indexOf(i);t&&this._baselayers.splice(t,1)}delete this._layers[i],this.emitter.emit("layer:remove",e)}}addGeoJsonLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;return t=t||{},t.multiselect=void 0!==t.multiselect&&t.multiselect,t.unselectOnSecondClick=void 0===t.unselectOnSecondClick||t.unselectOnSecondClick,e||(t=function(t){if(t.data){const e=c[function(t){let e;return e="FeatureCollection"===t.type?n(t.features.map((t=>t.geometry.type))):"GeometryCollection"===t.type?n(t.geometries.map((t=>t.type))):"Feature"===t.type?t.geometry.type:t.type,e}(t.data)],i=t.paint;i&&(0,o.GY)(i)&&(i.type=i.type?i.type:"polygon"===e||"line"===e?"path":"html"in i||"className"in i?"icon":a[e]),t.type=t.type||e}return t}(t)),t.paint=t.paint||{},this.addLayer(e||"GEOJSON",t)}addFeatureLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.addGeoJsonLayer(t)}addTileLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addLayer("TILE",{...e,url:t})}addImageLayer(t,e){let i;return"string"==typeof t?i=t:(i=t.url,e=t),this.addLayer("IMAGE",{...e,url:i})}showLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.toggleLayer(t,!0,e)}hideLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.toggleLayer(t,!1,e)}toggleLayer(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.getLayer(t),o=s&&s.options.visibility,r=void 0!==e?e:!o,n=void 0!==i.silent&&i.silent,a=async t=>{const e=String(t.id),i=r?"layer:preshow":"layer:prehide",s=r?"layer:show":"layer:hide";if(n||(this._emitLayerEvent(i,e,t),this._emitLayerEvent("layer:pretoggle",e,t)),r&&this.mapAdapter){const e=t.options.baselayer?0:t.options.order;if(t.options.baselayer&&this._baselayers.length){const e=this._baselayers.filter((e=>e!==t.id&&this.isLayerVisible(e)));for(const t of e)await this.hideLayer(t)}t.showLayer?await t.showLayer.call(t,t.layer):void 0!==t.layer&&await this.mapAdapter.showLayer(t.layer),void 0!==e&&this.mapAdapter.setLayerOrder(t.layer,e,this._layers)}else t.hideLayer?await t.hideLayer.call(t,t.layer):void 0!==t.layer&&await this.mapAdapter.hideLayer(t.layer);t.options.visibility=r,n||(this._emitLayerEvent(s,e,t),this._emitLayerEvent("layer:toggle",e,t))};return s&&s.options.visibility!==r?this.onMapLoad().then((()=>a(s))):Promise.resolve()}updateLayer(t){const e=this.getLayer(t);if(e){if(e.updateLayer)return Promise.resolve(e.updateLayer());if(this.isLayerVisible(e))return this.hideLayer(e,{silent:!0}).then((()=>this.showLayer(e,{silent:!0})))}return Promise.resolve()}setLayerOpacity(t,e){const i=this.getLayer(t);i&&(i.setOpacity?i.setOpacity(e):this.mapAdapter.setLayerOpacity&&this.mapAdapter.setLayerOpacity(i.layer,e))}selectLayer(t,e){const i=this.getLayer(t);if(i){const t=i;t&&t.select&&t.select(e);const s=this.getLayerId(i);s&&this._selectedLayers.push(s)}}unSelectLayer(t,e){const i=this.getLayer(t);if(i){const t=i&&i;t.unselect&&t.unselect(e);const s=this.getLayerId(i);if(s){const t=this._selectedLayers.indexOf(s);-1!==t&&this._selectedLayers.splice(t,1)}}}unSelectLayers(){const t=Object.values(this.allLayers());let e;for(e of t)e.unselect&&e.unselect()}filterLayer(t,e){const i=this.getLayer(t);return i.filter?i.filter(e):[]}propertiesFilter(t,e,i){const s=this.getLayer(t);if(!s)return;const o=s;o.propertiesFilter?o.propertiesFilter(e,i):o.filter&&this.filterLayer(o,(t=>!t.feature||!t.feature.properties||(0,r.Ml)(t.feature.properties,e)))}removeLayerFilter(t){const e=this.getLayer(t);e.removeFilter?e.removeFilter():e.filter&&e.filter((()=>!0))}setLayerData(t,e){const i=this.getLayer(t);if(i){if(i.setData)return i.setData(e);if(i.clearLayer&&i.addData)return i.clearLayer(),i.addData(e)}return Promise.resolve()}addLayerData(t,e){const i=this.getLayer(t);i.addData&&i.addData(e)}clearLayerData(t,e){const i=this.getLayer(t);i&&i.clearLayer&&i.clearLayer(e)}setLayerPaint(t,e){const i=this.getLayer(t);e&&i&&i.setPaint&&i.setPaint(e)}setLayerSelectedPaint(t,e){const i=this.getLayer(t);e&&i&&i.setSelectedPaint&&i.setSelectedPaint(e)}updateLayerPaint(t,e){const i=this.getLayer(t);e&&i&&i.updatePaint&&i.updatePaint(e)}updateLayerSelectedPaint(t,e){const i=this.getLayer(t);e&&i&&i.updateSelectedPaint&&i.updateSelectedPaint(e)}getAttributions(t){const e=[];for(const i in this._layers){const s=this._layers[i];let o=!(void 0===t.onlyVisible||t.onlyVisible)||s.options.visibility;if(o&&t.onlyBaselayer&&(o=this._baselayers.includes(i)),o){const t=s.options&&s.options.attribution;t&&e.push(t)}}return e}getActiveBaseLayer(){const t=this.getBaseLayers().find((t=>this.isLayerVisible(t)));if(t)return this.getLayer(t)}addTileJsonLayer(t){const e=t.tiles[0];return this.addLayer("TILE",{url:e,maxZoom:t.maxzoom,minZoom:t.minzoom,subdomains:t.scheme,attribution:t.attribution})}_emitLayerEvent(t,e,i){const o=String(t);if((0,s.r)(e)&&o.startsWith("layer:")){const t=o.replace("layer:","layer-"+e+":");this.emitter.emit(t,i)}this.emitter.emit(t,i)}async _onLayerClick(t){const e=t.layer.id;return this._emitLayerEvent("layer:click",e||"",t),Promise.resolve(t)}async _onLayerSelect(t){return this._emitLayerEvent("layer:select",t.layer.id||"",t),Promise.resolve(t)}_updateGeoJsonOptions(t){const{onSelect:e,onLayerSelect:i,onClick:r,onLayerClick:n,onMouseOut:a,onMouseOver:c}=t,l=r||n;t.onClick=t=>(l&&l(t),this._onLayerClick(t)),t.onMouseOut=t=>{const e=t.layer.id;a&&a(t),(0,s.r)(e)&&this._emitLayerEvent("layer:mouseout",e,t)},t.onMouseOver=t=>{const e=t.layer.id;c&&c(t),(0,s.r)(e)&&this._emitLayerEvent("layer:mouseover",e,t)};const h=e||i;t.onSelect=t=>(h&&h(t),this._onLayerSelect(t)),t.nativePaint||(this.options.paint&&(t.paint=(0,o.Yx)(t.paint||{},this.options.paint,this.getPaintFunctions)),t.selectedPaint&&this.options.selectedPaint&&(t.selectedPaint=(0,o.Yx)(t.selectedPaint,this.options.selectedPaint,this.getPaintFunctions)))}}function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class k extends A{constructor(){super(...arguments),E(this,"_loadControlQueue",{"top-right":[],"bottom-right":[],"top-left":[],"bottom-left":[]}),E(this,"_isControlLoading",{"top-right":!1,"bottom-right":!1,"top-left":!1,"bottom-left":!1})}async addControl(t,e,i){var s;let o;if(e=null!==(s=e)&&void 0!==s?s:"top-left",o="string"==typeof t?this.getControl(t,i):t,o)return new Promise((t=>{this._setControlQueue(e,(async()=>{const i=await o,s=this.mapAdapter.addControl(i,e);t(s)}))}))}async createControl(t,e){if(await this.onLoad("build-map"),this.mapAdapter.createControl)return this.mapAdapter.createControl(t,e)}async createButtonControl(t){if(await this.onLoad("build-map"),this.mapAdapter.createButtonControl)return this.mapAdapter.createButtonControl(t)}async createToggleControl(t){return await this.onLoad("build-map"),this.mapAdapter.createToggleControl?this.mapAdapter.createToggleControl(t):this.mapAdapter.createButtonControl?function(t,e){const i=document.createElement("div");let s=!1;e.getStatus?s=e.getStatus():e.status&&(s=e.status);const o=e.title||"",r=e.html;function n(){o&&(i.title="string"==typeof o?o:s?o.on:o.off,i.setAttribute("aria-label",i.title))}function a(t){t instanceof HTMLElement?(i.innerHTML="",i.appendChild(t)):"string"==typeof t&&(i.innerHTML=t)}function c(){r&&("string"==typeof r||r instanceof HTMLElement?a(r):a(s?r.on:r.off),i.setAttribute("aria-label",i.title))}function l(t,e){t.split(" ").forEach((t=>{e?i.classList.add(t):i.classList.remove(t)}))}function h(){e.addClassOn&&l(e.addClassOn,s),e.addClassOff&&l(e.addClassOff,!s)}n(),c(),e.addClass&&l(e.addClass,!0),h();const p=t=>{void 0!==t&&(s=t),c(),n(),h()},u=t=>{if(s=void 0!==t?t:!s,e.onClick){const t=e.onClick(s);Promise.resolve(t).then((()=>p())).catch((()=>s=!s))}else p()},d=t({html:i,onClick:u});return d.onClick=u,d.changeStatus=p,d}(this.mapAdapter.createButtonControl,t):void 0}removeControl(t){"remove"in t?t.remove():this.mapAdapter.removeControl&&Promise.resolve(t).then((t=>{this.mapAdapter.removeControl(t)}))}getControl(t,e){const i=this.mapAdapter.controlAdapters[t];if(i)return new i(e);{const i=k.controls[t];if(i)return i(this,e)}}getControlContainer(){if(this.mapAdapter.getControlContainer)return this.mapAdapter.getControlContainer()}_setControlQueue(t,e){this._loadControlQueue[t].push(e),this._isControlLoading[t]||this._applyControls(t)}async _applyControls(t){if(this._loadControlQueue[t].length){this._isControlLoading[t]=!0;const e=this._loadControlQueue[t][0];await e(),this._loadControlQueue[t].splice(0,1),this._applyControls(t)}else this._isControlLoading[t]=!1}}E(k,"controls",{CONTROL:(t,e)=>t.createControl(e.control,e.options),BUTTON:(t,e)=>t.createButtonControl(e),TOGGLE:(t,e)=>t.createToggleControl(e)});const S={};class I extends k{constructor(t){var e;super(t),this._addControls(),e=this.id,S[e]=this}static get(t){return function(t){return S[t]}(t)}async _addLayerProviders(){for await(const t of this._starterKits)if(t.getLayerAdapters){const e=await t.getLayerAdapters.call(t);if(e)for await(const t of e){const e=await t.createAdapter(this);e&&(this.mapAdapter.layerAdapters[t.name]=e)}}}async _onLoadSync(){for await(const t of this._starterKits)if(t.onLoadSync)try{await t.onLoadSync.call(t,this)}catch(t){console.error(t)}}_addControls(){this.options.controls&&this.options.controls.forEach((t=>{let e=t,i={};"string"==typeof t&&this.options.controlsOptions&&this.options.controlsOptions[t]&&(i=this.options.controlsOptions[t],void 0!==i.control&&(e=i.control));const{position:s,...o}=i;this.addControl(e,s||"top-left",o)})),this._emitStatusEvent("controls:create")}}}}]);
//# sourceMappingURL=main-84208dbdf311aab.js.map