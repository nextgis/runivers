"use strict";(globalThis.webpackChunkrussia_history=globalThis.webpackChunkrussia_history||[]).push([[756],{78879:(e,t,i)=>{i.d(t,{e:()=>p});var r=i(37954),a=i(17187),n=i(43812);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class p extends class{constructor(e,t){this.app=e,s(this,"name",void 0),s(this,"baseUrl",void 0),s(this,"manualOpacity",void 0),s(this,"filterIdField",void 0),s(this,"order",void 0),s(this,"opacity",1),s(this,"simplification",8),s(this,"selectOnLayerClick",!1),s(this,"oldNgwMvtApi",!1),Object.assign(this,t)}get groupLayer(){return this.app.timeMap&&this.app.timeMap.getTimeGroup(this.name)}}{constructor(e,t){super(e,t),this.app=e,o(this,"oldNgwMvtApi",!0),o(this,"emitter",new a.EventEmitter),o(this,"events",void 0),this.events=new n.z(this.emitter),this.app.webMap.onLoad().then((()=>this._registerMapboxImages()))}addLayers(e,t){return this._createTimeLayers(e,t)}_registerMapboxImages(){const e=this.app.webMap.mapAdapter.map;e&&e.loadImage(r,((t,i)=>{i&&(e.addImage("city",i),this.emitter.emit("load-images"))}))}_createTimeLayers(e,t){const i=t;return[this.events.onLoad("load-images").then((()=>this.app.webMap.addLayer("MVT",{url:e,id:t,order:this.order,paint:{"text-color":"rgba(255, 255, 255, 1)","text-halo-color":"rgba(49, 67, 90, .9)","text-halo-width":1},layout:{"icon-image":"city","icon-allow-overlap":!0,"icon-optional":!0,"text-field":["to-string",["get","toponym"]],"text-anchor":"top","text-size":10,"text-font":["Open Sans Bold"],"text-variable-anchor":["top"],"text-radial-offset":.95,"text-line-height":1.1,"text-letter-spacing":.06,"text-padding":0,"text-justify":"auto"},nativeOptions:{type:"symbol"},nativePaint:!0,type:"point",sourceLayer:i}).then((e=>e))))]}}},41171:(e,t,i)=>{i.d(t,{u:()=>p});var r=i(21037),a=i(24613),n=i(25952),s=i(28691);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class p{constructor(e){this.app=e,o(this,"name",void 0),o(this,"baseUrl",void 0),o(this,"manualOpacity",void 0),o(this,"filterIdField",void 0),o(this,"opacity",1),o(this,"simplification",8),o(this,"currentPointId",void 0),o(this,"_markers",[]),o(this,"_pointsConfig",[])}setPoints(e){this._pointsConfig=this._processPointsMeta(e);const t=this._getPointIdByYear(this.app.timeMap.currentYear);t&&this.updatePoint(t)}remove(){this._markers.forEach((e=>{e.marker.remove()})),this._markers=[]}updatePoint(e){e!==this.currentPointId&&(this.currentPointId&&this.remove(),this.currentPointId=e,e&&this._addPoint(e))}updateActiveMarker(e){e&&this._markers.forEach((t=>{t.properties.year===e.year&&t.properties.numb===e.numb?t.element.classList.add("active"):t.element.classList.remove("active")}))}_getPointIdByYear(e){const t=this._getPointByYear(e);if(t)return t&&String(t.id)}_addPoint(e){(0,s.Q)(e).then((e=>{const t=e.features.length>1&&(0,n.u)(e.features.map((e=>e.properties.numb))),i=t&&t.length>1;e.features.forEach(((e,t)=>{const r=e&&e.geometry&&e.geometry.type;"MultiPoint"===r?e.geometry.coordinates.forEach((t=>{this._addMarkerToMap(t,e.properties,i)})):"Point"===r&&this._addMarkerToMap(e.geometry.coordinates,e.properties,i)}))}))}_addMarkerToMap(e,t,i){const n=this.app.webMap.mapAdapter.map;if(n){const s=document.createElement("div");let o;if(this.app.controls.yearsStatPanelControl){const e=this.app.controls.yearsStatPanelControl.yearStat;o=e&&e.year===t.year&&e.numb===t.numb}s.className="map-marker"+(o?" active":"");const p=document.createElement("div");p.className="map-marker--inner",p.innerHTML=i?`<div class="map-marker__label">${t.numb}</div>`:"",s.appendChild(p);const c=(0,r.Z)("EPSG:3857").inverse(e),d=new a.Marker(s),l={marker:d,element:s,properties:t};this._markers.push(l),d.setLngLat(c),d.addTo(n),s.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this._setMarkerActive(l,t)}))}}_setMarkerActive(e,t){const i=this.app.controls.yearsStatPanelControl;if(i&&i.yearStats){const e=i.yearStats.find((e=>e.year===t.year&&e.numb===t.numb));e&&(i.updateYearStat(e),i.unBlock(),i.show())}}_getPointByYear(e){return this._pointsConfig.find((t=>t.year===e))}_processPointsMeta(e){return e.map((e=>{let{resource:t}=e;const i=t.display_name,r=i.match("(\\d{4})*$"),[a]=r.slice(1).map((e=>Number(e)));return{name:i,year:a,id:t.id}}))}}},8973:(e,t,i)=>{i(28594),i(35666);var r=i(48651),a=i(14646),n=i(51181),s=i(4147),o=i(80055),p=i.n(o),c=i(83625),d=i.n(c),l=i(76058),h=i.n(l),m=i(77309),u=i.n(m),y=i(26782),g=i.n(y);const v=new a.g({baseUrl:n.FH,target:"map",fromYear:850,timeStops:[{toYear:1462,name:"principalities"}],currentYear:1462,animationDelay:200,animationStep:1,bounds:[2,27,203,82],minZoom:3,periods:p(),yearsStat:function(){const e={};d().forEach((t=>{e[t.year]=e[t.year]||[],e[t.year].push(t)}));for(const t in e){const i=e[t];i.length>1&&i.forEach(((e,t)=>{(0,r.r)(e.count)||(e.numb=t+1)}))}return d()}(),areaStat:h(),principalities01:u(),principalities02:g(),version:s.i8,lineColor:n.lineColor,lineColorLegend:n.vg});v.emitter.on("build",(()=>{const e=document.getElementsByClassName("noUi-marker-large");e.length&&[e[0],e[e.length-1]].forEach((e=>{e.style.display="none"}))})),window.app=v,window.version=s.i8},76005:(e,t,i)=>{i.d(t,{x:()=>a});var r=i(56259);function a(e){r&&setTimeout((()=>{e(r)}))}},28691:(e,t,i)=>{i.d(t,{Q:()=>p,E:()=>o});var r=i(77869),a=i(51181);const n=a.FH,s=new r.Z({baseUrl:n});function o(){return s.makeQuery("/api/resource/?parent={id}",{id:a.tk},{})}function p(e){return s.makeQuery("/api/resource/{id}/geojson",{id:e},{})}},1319:(e,t,i)=>{i.d(t,{B:()=>r});const r=new(i(55502).Z)},95096:(e,t,i)=>{i.d(t,{S:()=>a});var r=i(99223);function a(e){return`${(0,r._)(Math.round(e))} км²`}}},e=>{e.O(0,[604,208,544,367,252,594,461,613,683,983,385,692,853,659,517,523,965,494],(()=>(8973,e(e.s=8973)))),e.O()}]);
//# sourceMappingURL=main-0a037d97f311aab.js.map